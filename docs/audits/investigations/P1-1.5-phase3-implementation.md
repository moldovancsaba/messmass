# P1 1.5 Phase 3 – Remove Per-Row Font Size Logic Implementation

**Date:** 2026-01-11T11:00:00.000Z  
**Status:** Phase 3 Complete  
**Investigator:** Tribeca  
**Reference:** `P1-1.5-unified-typography-solution.md` Phase 3

---

## Phase 3 Goal

Remove per-row font size calculations and props. Since CSS now uses `--block-base-font-size` and `--block-subtitle-font-size` directly (Phase 2), the props and state are no longer needed.

---

## Changes Implemented

### 1. CellWrapper Component

**File:** `components/CellWrapper.tsx`

**Removed:**
- `titleFontSize?: number` and `subtitleFontSize?: number` from `CellWrapperProps` interface (lines 11-12)
- `titleFontSize` and `subtitleFontSize` from function parameters (lines 28-29)
- CSS custom property setting for `--title-font-size` and `--subtitle-font-size` (lines 44, 46)

**Rationale:** CSS now references block-level variables directly (Phase 2), so these props are obsolete.

---

### 2. ResponsiveRow Component

**File:** `app/report/[slug]/ReportContent.tsx`

**Removed:**
- `blockTitleFontSize?: number | null` and `blockSubtitleFontSize?: number | null` from `ResponsiveRowProps` interface (lines 182-183)
- `blockTitleFontSize` and `blockSubtitleFontSize` from function parameters (line 186)
- `titleFontSize` and `subtitleFontSize` state declarations (lines 208-209)
- State update logic from `useEffect` (lines 243-251)
- Block font sizes from dependency array (line 271)
- `titleFontSize` and `subtitleFontSize` props passed to `ReportChart` (lines 344-345)

**Rationale:** CSS now references block-level variables directly (Phase 2), so these props and state are obsolete.

---

### 3. ReportBlock Component

**File:** `app/report/[slug]/ReportContent.tsx`

**Removed:**
- `blockTitleFontSize={blockBaseFontSize}` and `blockSubtitleFontSize={blockSubtitleFontSize}` props passed to `ResponsiveRow` (lines 555-556)

**Rationale:** `ResponsiveRow` no longer needs these props since CSS uses block-level variables directly.

---

### 4. ReportChart Component

**File:** `app/report/[slug]/ReportChart.tsx`

**Removed:**
- `titleFontSize?: number` and `subtitleFontSize?: number` from `ReportChartProps` interface (lines 89, 92)
- `titleFontSize` and `subtitleFontSize` from function parameters (line 115)
- Props passed to all chart components (KPIChart, PieChart, BarChart, TextChart, ImageChart, TableChart) (lines 159, 162, 165, 168, 171, 174, 180-181)

**Rationale:** Chart components no longer need these props since CSS uses block-level variables directly.

---

### 5. Chart Components

**File:** `app/report/[slug]/ReportChart.tsx`

**Removed:**
- `titleFontSize?: number` and `subtitleFontSize?: number` from all chart component function signatures:
  - `KPIChart` (line 200)
  - `PieChart` (line 244)
  - `BarChart` (line 426)
  - `TextChart` (line 610)
  - `TableChart` (line 744)
  - `ImageChart` (line 883)
- Props passed to `CellWrapper` in:
  - `BarChart` (lines 564-565)
  - `TableChart` (lines 857-858)
  - `ImageChart` (lines 940-941)

**Rationale:** `CellWrapper` no longer needs these props since CSS uses block-level variables directly.

---

## Summary

**Total removals:** ~26 changes across 3 files

1. **CellWrapper.tsx:** 6 changes
   - Removed from interface (2)
   - Removed from function parameters (2)
   - Removed CSS custom property setting (2)

2. **ReportContent.tsx:** 10 changes
   - Removed from ResponsiveRowProps interface (2)
   - Removed from function parameters (2)
   - Removed state declarations (2)
   - Removed state update logic
   - Removed from dependency array
   - Removed props passed to ReportChart (2)
   - Removed props passed to ResponsiveRow from ReportBlock (2)

3. **ReportChart.tsx:** 10+ changes
   - Removed from ReportChartProps interface (2)
   - Removed from function parameters (2)
   - Removed from all chart component calls (6 components × 2 props = 12)
   - Removed from all chart component function signatures (6 components × 2 props = 12)
   - Removed from CellWrapper calls (3 components × 2 props = 6)

**No changes to:**
- Typography scales, clamps, ratios
- Layout/structure
- KPI value scaling (exempt)
- Block-level typography calculation (Phase 1)
- CSS consumers (Phase 2)

---

## Local Gate Results

**Build:** ✅ Pass  
**Linting:** ✅ No errors  
**TypeScript:** ✅ No errors

**Command:**
```bash
npm run build
```

**Result:** Build completed successfully with no errors or warnings.

---

## Testing Notes

### Expected Behavior

- **No prop passing:** `titleFontSize` and `subtitleFontSize` props no longer passed through component tree
- **CSS inheritance:** Typography inherits from block-level CSS variables (`--block-base-font-size`, `--block-subtitle-font-size`)
- **Simplified component tree:** Reduced prop drilling, cleaner component interfaces
- **No functional changes:** Typography behavior unchanged (CSS still uses block-level variables)

### Testing Required

- [ ] Verify typography still works correctly (inherits from block-level CSS variables)
- [ ] Verify no TypeScript errors
- [ ] Verify no runtime errors
- [ ] Verify no regression in existing typography behavior

---

## Files Modified

1. `components/CellWrapper.tsx`
   - Removed `titleFontSize` and `subtitleFontSize` from interface
   - Removed from function parameters
   - Removed CSS custom property setting

2. `app/report/[slug]/ReportContent.tsx`
   - Removed `blockTitleFontSize` and `blockSubtitleFontSize` from `ResponsiveRowProps`
   - Removed from `ResponsiveRow` function parameters
   - Removed `titleFontSize` and `subtitleFontSize` state
   - Removed state update logic
   - Removed from dependency array
   - Removed props passed to `ReportChart`
   - Removed props passed to `ResponsiveRow` from `ReportBlock`

3. `app/report/[slug]/ReportChart.tsx`
   - Removed `titleFontSize` and `subtitleFontSize` from `ReportChartProps`
   - Removed from function parameters
   - Removed from all chart component calls
   - Removed from all chart component function signatures
   - Removed from `CellWrapper` calls

---

## Next Steps

**Phase 3 Status:** ✅ Complete  
**Next Phase:** Phase 4 - Align Text Chart Typography (awaiting approval)

**Before Proceeding:**
- Await approval from Chappie
- Perform preview verification if requested
- Document any issues found during testing

---

## Commit

**Commit:** (to be added after commit)  
**Message:** `feat(p1-1.5-phase3): Remove per-row font size logic and props`

**Changes:**
- Remove titleFontSize and subtitleFontSize props from CellWrapper interface and component
- Remove blockTitleFontSize and blockSubtitleFontSize props from ResponsiveRow
- Remove titleFontSize and subtitleFontSize state from ResponsiveRow
- Remove titleFontSize and subtitleFontSize props from ReportChart and all chart components
- Remove CSS custom property setting for --title-font-size and --subtitle-font-size
- Phase 3 complete: Per-row font size logic removed, CSS uses block-level variables directly
