# P1 1.5 Phase 2 – Update CSS to Use Block Typography Implementation

**Date:** 2026-01-10T14:10:05.420Z  
**Status:** Phase 2 Complete  
**Investigator:** Tribeca  
**Reference:** `P1-1.5-unified-typography-solution.md` Phase 2

---

## Phase 2 Goal

Update CSS consumers to reference block-level typography variables (`--block-base-font-size` and `--block-subtitle-font-size`) instead of per-row or per-component font-size usage.

---

## Changes Implemented

### 1. CellWrapper Title Zone

**File:** `components/CellWrapper.module.css:21`

**Before:**
```css
font-size: var(--title-font-size);
```

**After:**
```css
font-size: var(--block-base-font-size); /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of per-row */
```

**Rationale:** Title zone now uses block-level typography instead of per-row `--title-font-size`.

---

### 2. CellWrapper Subtitle Zone

**File:** `components/CellWrapper.module.css:49`

**Before:**
```css
font-size: var(--subtitle-font-size);
```

**After:**
```css
font-size: var(--block-subtitle-font-size); /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of per-row */
```

**Rationale:** Subtitle zone now uses block-level typography instead of per-row `--subtitle-font-size`.

---

### 3. Chart Title

**File:** `app/report/[slug]/ReportChart.module.css:51`

**Before:**
```css
font-size: clamp(0.9rem, 2.8cqw, 1.25rem);
```

**After:**
```css
font-size: var(--block-base-font-size); /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of independent scaling */
```

**Rationale:** Chart titles now use unified block typography instead of independent responsive scaling.

---

### 4. KPI Label (Non-Value)

**File:** `app/report/[slug]/ReportChart.module.css:169`

**Before:**
```css
font-size: clamp(0.75rem, 15cqh, 1.5rem);
```

**After:**
```css
font-size: var(--block-base-font-size); /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of independent scaling */
```

**Rationale:** KPI labels now participate in unified typography (per specification). Only KPI values remain exempt.

---

### 5. Pie Chart Title Text

**File:** `app/report/[slug]/ReportChart.module.css:217`

**Before:**
```css
font-size: clamp(1rem, 9cqh, 1.5rem);
```

**After:**
```css
font-size: var(--block-base-font-size); /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of independent scaling */
```

**Rationale:** Pie chart titles now use unified block typography.

---

### 6. Pie Chart Title (Alternative)

**File:** `app/report/[slug]/ReportChart.module.css:238`

**Before:**
```css
font-size: clamp(0.9rem, 2.6cqw, 1.2rem);
```

**After:**
```css
font-size: var(--block-base-font-size); /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of independent scaling */
```

**Rationale:** Pie chart titles now use unified block typography.

---

### 7. Pie Chart Label

**File:** `app/report/[slug]/ReportChart.module.css:266`

**Before:**
```css
font-size: clamp(0.7rem, 2cqw, 0.9rem);
```

**After:**
```css
font-size: var(--block-base-font-size); /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of independent scaling */
```

**Rationale:** Pie chart labels now use unified block typography.

---

### 8. Pie Chart Legend Text

**File:** `app/report/[slug]/ReportChart.module.css:354-357`

**Before:**
```css
font-size: clamp(
  var(--mm-font-size-xxs, 0.625rem),
  min(20cqh, 12cqw),
  var(--mm-font-size-xl, 1.25rem)
);
```

**After:**
```css
font-size: var(--block-base-font-size); /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of independent scaling */
```

**Rationale:** Chart legends now use unified block typography.

---

### 9. Bar Chart Title

**File:** `app/report/[slug]/ReportChart.module.css:386`

**Before:**
```css
font-size: clamp(0.9rem, 2.6cqw, 1.2rem);
```

**After:**
```css
font-size: var(--block-base-font-size); /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of independent scaling */
```

**Rationale:** Bar chart titles now use unified block typography.

---

### 10. Bar Chart Label

**File:** `app/report/[slug]/ReportChart.module.css:424`

**Before:**
```css
font-size: clamp(0.85rem, 9cqh, 1.1rem);
```

**After:**
```css
font-size: var(--block-base-font-size); /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of independent scaling */
```

**Rationale:** Bar chart labels now use unified block typography.

---

### 11. Text Chart Title Text

**File:** `app/report/[slug]/ReportChart.module.css:513`

**Before:**
```css
font-size: clamp(0.95rem, 2.6cqw, 1.25rem) !important;
```

**After:**
```css
font-size: var(--block-base-font-size) !important; /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of independent scaling */
```

**Rationale:** Text chart titles now use unified block typography.

---

### 12. Text Chart Content (Option B)

**File:** `app/report/[slug]/ReportChart.module.css:561`

**Before:**
```css
font-size: var(--unified-text-font-size, clamp(0.75rem, min(12cqh, 10cqw), 4rem)) !important;
```

**After:**
```css
font-size: var(--block-base-font-size) !important; /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of unified-text-font-size (Option B) */
```

**Rationale:** Solution document recommends Option B - align text chart typography with block typography. Text charts now use `--block-base-font-size` instead of `--unified-text-font-size`.

---

### 13. Table Content

**File:** `app/report/[slug]/ReportChart.module.css:863`

**Before:**
```css
font-size: clamp(0.75rem, 1.5cqw, 0.875rem);
```

**After:**
```css
font-size: var(--block-base-font-size); /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of independent scaling */
```

**Rationale:** Table headers and cells now use unified block typography.

---

## Exemptions Preserved

### KPI Value

**File:** `app/report/[slug]/ReportChart.module.css:143`

**Status:** ✅ **EXEMPT** - No changes made. KPI values continue to scale independently with `clamp(1.25rem, min(30cqh, 25cqw), 6rem)` as per explicit exemption.

---

## Summary

**Total CSS updates:** 13

1. CellWrapper title zone (1)
2. CellWrapper subtitle zone (1)
3. Chart title (1)
4. KPI label (1)
5. Pie chart title text (1)
6. Pie chart title (1)
7. Pie chart label (1)
8. Pie chart legend text (1)
9. Bar chart title (1)
10. Bar chart label (1)
11. Text chart title text (1)
12. Text chart content (1)
13. Table content (1)

**Exemptions preserved:** KPI value (1)

**No changes to:**
- Typography scales, clamps, ratios (only replaced with block variables)
- Layout/structure
- New CSS variables introduced
- KPI value scaling (exempt)

---

## Local Gate Results

**Build:** ✅ Pass  
**Linting:** ✅ No errors  
**TypeScript:** ✅ No errors

**Command:**
```bash
npm run build
```

**Result:** Build completed successfully with no errors or warnings.

---

## Testing Notes

### Expected Behavior

- **Block-level typography:** All typography elements within a block use `--block-base-font-size` or `--block-subtitle-font-size`
- **Unified appearance:** Titles, subtitles, labels, legends, and table content share the same font size within a block
- **KPI exemption:** KPI values continue to scale independently
- **Responsive behavior:** Font sizes recalculate when block width changes (handled by Phase 1)

### Testing Required

- [ ] Verify all titles in a block share the same font size
- [ ] Verify all subtitles in a block share the same font size
- [ ] Verify all labels in a block share the same font size
- [ ] Verify all legends in a block share the same font size
- [ ] Verify table content uses block typography
- [ ] Verify text chart content uses block typography (Option B)
- [ ] Verify KPI values still scale independently (exemption preserved)
- [ ] Verify no regression in existing typography behavior

---

## Files Modified

1. `components/CellWrapper.module.css`
   - Line 21: `.titleZone` - `var(--title-font-size)` → `var(--block-base-font-size)`
   - Line 49: `.subtitleZone` - `var(--subtitle-font-size)` → `var(--block-subtitle-font-size)`

2. `app/report/[slug]/ReportChart.module.css`
   - Line 51: `.chartTitle` - `clamp()` → `var(--block-base-font-size)`
   - Line 169: `.kpi .kpiTitle` - `clamp()` → `var(--block-base-font-size)`
   - Line 217: `.pieTitleText` - `clamp()` → `var(--block-base-font-size)`
   - Line 238: `.pieTitle` - `clamp()` → `var(--block-base-font-size)`
   - Line 266: `.pieLabel` - `clamp()` → `var(--block-base-font-size)`
   - Line 354-357: `.pieLegendText` - `clamp()` → `var(--block-base-font-size)`
   - Line 386: `.barTitle` - `clamp()` → `var(--block-base-font-size)`
   - Line 424: `.barLabel` - `clamp()` → `var(--block-base-font-size)`
   - Line 513: `.textTitleText` - `clamp()` → `var(--block-base-font-size)`
   - Line 561: `.textContent` - `var(--unified-text-font-size, clamp(...))` → `var(--block-base-font-size)`
   - Line 863: `.tableContent` - `clamp()` → `var(--block-base-font-size)`

---

## Next Steps

**Phase 2 Status:** ✅ Complete  
**Next Phase:** Phase 3 - Remove Per-Row Font Size Logic (awaiting approval)

**Before Proceeding:**
- Await approval from Chappie
- Perform preview verification if requested
- Document any issues found during testing

---

## Commit

**Commit:** (to be added after commit)  
**Message:** `feat(p1-1.5-phase2): Update CSS to use block-level typography variables`

**Changes:**
- Replace per-row and per-component font-size usage with `--block-base-font-size` and `--block-subtitle-font-size`
- Update CellWrapper title/subtitle zones to use block typography
- Update all chart titles, labels, legends, and table content to use block typography
- Update text chart content to use block typography (Option B)
- Preserve KPI value exemption (independent scaling)
- Phase 2 complete: CSS consumers now reference block-level typography
