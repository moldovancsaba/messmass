(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1057:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var s=a(5155),n=a(2115),o=a(5717),r=a.n(o);let c={remoteImages:0,hostessImages:0,selfies:0,indoor:0,outdoor:0,stadium:0,female:0,male:0,genAlpha:0,genYZ:0,genX:0,boomer:0,merched:0,jersey:0,scarf:0,flags:0,baseballCap:0,other:0};function l(){let[e,t]=(0,n.useState)(null),[a,o]=(0,n.useState)(""),[l,i]=(0,n.useState)(new Date().toISOString().split("T")[0]),[d,u]=(0,n.useState)(c),[p,_]=(0,n.useState)([]),[g,m]=(0,n.useState)(!1),[j,h]=(0,n.useState)(!1),[v,b]=(0,n.useState)("idle"),[x,y]=(0,n.useState)(!1),[f,N]=(0,n.useState)(0),[C,S]=(0,n.useState)("disconnected"),[T,I]=(0,n.useState)(null),w=(0,n.useRef)(null),k=(0,n.useRef)(null),D=(0,n.useRef)(null),B=(0,n.useCallback)(()=>{var e;if((null==(e=w.current)?void 0:e.readyState)!==WebSocket.OPEN){S("connecting");try{w.current=new WebSocket("wss://messmass-production.up.railway.app"),w.current.onopen=()=>{console.log("\uD83D\uDD17 WebSocket connected"),S("connected"),y(!0),k.current&&(clearTimeout(k.current),k.current=null)},w.current.onmessage=e=>{try{let t=JSON.parse(e.data);G(t)}catch(e){console.error("Failed to parse WebSocket message:",e)}},w.current.onclose=()=>{console.log("\uD83D\uDD0C WebSocket disconnected"),S("disconnected"),y(!1),N(0),D.current=null,k.current=setTimeout(()=>{B()},3e3)},w.current.onerror=e=>{console.error("❌ WebSocket error:",e),S("error")}}catch(e){console.error("Failed to create WebSocket connection:",e),S("error")}}},[]),G=(0,n.useCallback)(e=>{switch(console.log("\uD83D\uDCE8 Received:",e.type),e.type){case"connection_established":D.current=e.connectionId,console.log("✅ Connection ID:",e.connectionId);break;case"project_joined":N(e.activeUsers);break;case"user_joined":case"user_left":N(e.activeUsers),I("User ".concat(e.type.split("_")[1]," at ").concat(new Date(e.timestamp).toLocaleTimeString()));break;case"stat_updated":e.updatedBy!==D.current&&(u(t=>({...t,[e.statKey]:e.newValue})),I("".concat(e.statKey," updated by another user")));break;case"project_updated":e.updatedBy!==D.current&&(o(e.eventName),i(e.eventDate),u(e.stats),I("Project updated by another user at ".concat(new Date(e.timestamp).toLocaleTimeString())));break;case"stats_reset":e.resetBy!==D.current&&(u(e.stats),I("Stats reset by another user at ".concat(new Date(e.timestamp).toLocaleTimeString())));break;case"error":console.error("WebSocket error:",e.message);break;default:console.log("Unknown message type:",e.type)}},[]),A=(0,n.useCallback)(e=>{var t;return(null==(t=w.current)?void 0:t.readyState)===WebSocket.OPEN&&(w.current.send(JSON.stringify(e)),!0)},[]),E=(0,n.useCallback)(e=>{A({type:"join_project",projectId:e})||console.warn("Failed to join project room - WebSocket not connected")},[A]),P=(0,n.useCallback)(()=>{A({type:"leave_project"})},[A]);(0,n.useEffect)(()=>(B(),()=>{k.current&&clearTimeout(k.current),w.current&&w.current.close()}),[B]),(0,n.useEffect)(()=>{F()},[]),(0,n.useEffect)(()=>{if(e&&a.trim()){let e=setTimeout(()=>{U()},1e3);return()=>clearTimeout(e)}},[d,a,l,e]),(0,n.useEffect)(()=>{e&&x?E(e):!e&&x&&P()},[e,x,E,P]);let F=async()=>{try{let e=await fetch("/api/projects"),t=await e.json();t.projects&&_(t.projects)}catch(e){console.error("Failed to load projects:",e)}},M=async()=>{if(!a.trim())return void alert("Please enter an event name before saving.");b("saving");try{let e=await fetch("/api/projects",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({eventName:a,eventDate:l,stats:d})}),s=await e.json();s.success?(t(s.projectId),b("saved"),setTimeout(()=>b("idle"),2e3),F(),x&&E(s.projectId)):(b("error"),alert("Failed to save project. Please try again."))}catch(e){console.error("Failed to save project:",e),b("error"),alert("Failed to save project. Please check your connection.")}},U=async()=>{if(e&&a.trim()){b("saving");try{(await fetch("/api/projects",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,eventName:a,eventDate:l,stats:d})})).ok?(b("saved"),setTimeout(()=>b("idle"),2e3),A({type:"project_update",eventName:a,eventDate:l,stats:d})):b("error")}catch(e){console.error("Failed to update project:",e),b("error")}}},K=async a=>{e&&x&&P();try{let e=await fetch("/api/projects/".concat(a._id));if(e.ok){let a=await e.json();if(a.project){t(a.project._id),o(a.project.eventName),i(a.project.eventDate),u(a.project.stats),m(!1);return}}}catch(e){console.error("Failed to fetch fresh project data:",e)}t(a._id),o(a.eventName),i(a.eventDate),u(a.stats),m(!1)},O=async t=>{if(confirm("Are you sure you want to delete this project?"))try{(await fetch("/api/projects?projectId=".concat(t),{method:"DELETE"})).ok&&(F(),e===t&&L())}catch(e){console.error("Failed to delete project:",e)}},L=()=>{e&&x&&P(),t(null),o(""),i(new Date().toISOString().split("T")[0]),u(c),m(!1),N(0)},R=async()=>{let t={...c};if(e){if(!confirm("This will reset all statistics for this saved project. Are you sure?"))return;u(t),b("saving");try{(await fetch("/api/projects",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,eventName:a,eventDate:l,stats:t})})).ok?(b("saved"),setTimeout(()=>b("idle"),2e3),A({type:"reset_stats",resetStats:t})):b("error")}catch(e){console.error("Failed to reset project stats:",e),b("error")}}else u(t)},W=d.remoteImages+d.hostessImages+d.selfies,X=d.indoor+d.outdoor+d.stadium,Z=d.female+d.male,J=d.genAlpha+d.genYZ,V=d.genX+d.boomer,Y=J+V,H=d.merched+d.jersey+d.scarf+d.flags+d.baseballCap+d.other,q=t=>{let{label:a,value:n,statKey:o,isCalculated:c=!1,isWarning:l=!1}=t;return(0,s.jsxs)("div",{className:r().statCardContainer,children:[(0,s.jsxs)("div",{className:"".concat(r().statCard," ").concat(c?r().calculatedCard:""," ").concat(l?r().warningCard:""),onClick:o?()=>(t=>{let a=d[t]+1;u(e=>({...e,[t]:a})),e&&x&&A({type:"stat_increment",statKey:t,newValue:a})})(o):void 0,style:{cursor:c?"default":"pointer"},children:[(0,s.jsx)("div",{className:r().statLabel,children:a}),(0,s.jsx)("div",{className:r().statValue,children:n})]}),o&&!c&&(0,s.jsx)("button",{className:r().decrementButton,onClick:t=>{t.stopPropagation();if(d[o]>0){let t=d[o]-1;u(e=>({...e,[o]:t})),e&&x&&A({type:"stat_increment",statKey:o,newValue:t})}},disabled:0===n,children:"-1"})]})};return(0,s.jsx)("main",{className:r().main,children:(0,s.jsxs)("div",{className:r().container,children:[(0,s.jsxs)("div",{className:r().header,children:[e&&a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h1",{className:r().title,children:a}),(0,s.jsx)("p",{className:r().subtitle,children:new Date(l).toLocaleDateString()})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h1",{className:r().title,children:"MessMass"}),(0,s.jsx)("p",{className:r().subtitle,children:"Event Statistics Dashboard"})]}),(0,s.jsx)(()=>(0,s.jsxs)("div",{className:r().connectionStatus,children:[(0,s.jsxs)("div",{className:"".concat(r().statusIndicator," ").concat(r()[C]),children:["connected"===C&&"\uD83D\uDFE2","connecting"===C&&"\uD83D\uDFE1","disconnected"===C&&"\uD83D\uDD34","error"===C&&"❌"]}),(0,s.jsxs)("span",{className:r().statusText,children:["connected"===C&&"Connected (".concat(f," user").concat(1!==f?"s":"",")"),"connecting"===C&&"Connecting...","disconnected"===C&&"Offline","error"===C&&"Connection Error"]})]}),{}),T&&(0,s.jsxs)("div",{className:r().lastUpdate,children:["\uD83D\uDCE1 ",T]}),(0,s.jsxs)("div",{className:r().projectControls,children:[(0,s.jsxs)("button",{className:r().projectButton,onClick:()=>m(!g),children:["\uD83D\uDCC1 ",g?"Hide":"Show"," Projects (",p.length,")"]}),(0,s.jsx)("button",{className:r().newProjectButton,onClick:L,children:"➕ New Project"}),"saving"===v&&(0,s.jsx)("span",{className:r().saveStatus,children:"\uD83D\uDCBE Auto-saving..."}),"saved"===v&&(0,s.jsx)("span",{className:r().saveStatus,children:"✅ Auto-saved"}),"error"===v&&(0,s.jsx)("span",{className:r().saveStatus,children:"❌ Save Error"})]})]}),g&&(0,s.jsxs)("div",{className:r().projectsList,children:[(0,s.jsx)("h3",{children:"Your Projects"}),0===p.length?(0,s.jsx)("p",{children:"No projects saved yet. Create your first project by adding an event name and date above."}):(0,s.jsx)("div",{className:r().projectsGrid,children:p.map(t=>(0,s.jsxs)("div",{className:"".concat(r().projectCard," ").concat(e===t._id?r().activeProject:""),children:[(0,s.jsxs)("div",{className:r().projectInfo,children:[(0,s.jsx)("h4",{children:t.eventName}),(0,s.jsx)("p",{children:new Date(t.eventDate).toLocaleDateString()}),(0,s.jsxs)("small",{children:["Updated: ",new Date(t.updatedAt).toLocaleDateString()]})]}),(0,s.jsxs)("div",{className:r().projectActions,children:[(0,s.jsx)("button",{onClick:()=>K(t),className:r().loadButton,children:"\uD83D\uDCC2 Load"}),(0,s.jsx)("button",{onClick:()=>O(t._id),className:r().deleteButton,children:"\uD83D\uDDD1️"})]})]},t._id))})]}),!e&&(0,s.jsxs)("div",{className:r().eventInfo,children:[(0,s.jsxs)("div",{className:r().inputGroup,children:[(0,s.jsx)("label",{className:r().label,children:"Event Name:"}),(0,s.jsx)("input",{type:"text",value:a,onChange:e=>o(e.target.value),placeholder:"Enter event name...",className:r().input})]}),(0,s.jsxs)("div",{className:r().inputGroup,children:[(0,s.jsx)("label",{className:r().label,children:"Event Date:"}),(0,s.jsx)("input",{type:"date",value:l,onChange:e=>i(e.target.value),className:r().input})]}),(0,s.jsx)("div",{className:r().saveProjectGroup,children:(0,s.jsx)("button",{className:r().saveProjectButton,onClick:M,disabled:!a.trim()||"saving"===v,children:"\uD83D\uDCBE Save Project"})})]}),(0,s.jsxs)("div",{className:r().statsGrid,children:[(0,s.jsxs)("div",{className:r().section,children:[(0,s.jsxs)("h3",{className:r().sectionTitle,children:["Images (",W,")"]}),(0,s.jsxs)("div",{className:r().statsRow,children:[(0,s.jsx)(q,{label:"Remote Images",value:d.remoteImages,statKey:"remoteImages"}),(0,s.jsx)(q,{label:"Hostess Images",value:d.hostessImages,statKey:"hostessImages"}),(0,s.jsx)(q,{label:"Selfies",value:d.selfies,statKey:"selfies"})]})]}),(0,s.jsxs)("div",{className:r().section,children:[(0,s.jsxs)("h3",{className:r().sectionTitle,children:["Fans (",X,")"]}),(0,s.jsxs)("div",{className:r().statsRow,children:[(0,s.jsx)(q,{label:"Indoor",value:d.indoor,statKey:"indoor"}),(0,s.jsx)(q,{label:"Outdoor",value:d.outdoor,statKey:"outdoor"}),(0,s.jsx)(q,{label:"Stadium",value:d.stadium,statKey:"stadium"})]})]}),(0,s.jsxs)("div",{className:r().section,children:[(0,s.jsxs)("h3",{className:"".concat(r().sectionTitle," ").concat(Z!==X?r().warningTitle:""),children:["Gender (",Z,")"]}),(0,s.jsxs)("div",{className:r().statsRow,children:[(0,s.jsx)(q,{label:"Female",value:d.female,statKey:"female"}),(0,s.jsx)(q,{label:"Male",value:d.male,statKey:"male"}),(0,s.jsx)(q,{label:"Total Gender",value:Z,isCalculated:!0,isWarning:Z!==X})]})]}),(0,s.jsxs)("div",{className:r().section,children:[(0,s.jsxs)("h3",{className:"".concat(r().sectionTitle," ").concat(Y!==X?r().warningTitle:""),children:["Age (",Y,")"]}),(0,s.jsxs)("div",{className:r().ageGrid,children:[(0,s.jsx)(q,{label:"Gen Alpha",value:d.genAlpha,statKey:"genAlpha"}),(0,s.jsx)(q,{label:"Gen Y+Z",value:d.genYZ,statKey:"genYZ"}),(0,s.jsx)(q,{label:"Total Under 40",value:J,isCalculated:!0}),(0,s.jsx)(q,{label:"Gen X",value:d.genX,statKey:"genX"}),(0,s.jsx)(q,{label:"Boomer",value:d.boomer,statKey:"boomer"}),(0,s.jsx)(q,{label:"Total Over 40",value:V,isCalculated:!0})]})]}),(0,s.jsxs)("div",{className:r().section,children:[(0,s.jsxs)("h3",{className:r().sectionTitle,children:["Merch (",H,")"]}),(0,s.jsxs)("div",{className:r().statsRow,children:[(0,s.jsx)(q,{label:"Merched",value:d.merched,statKey:"merched"}),(0,s.jsx)(q,{label:"Jersey",value:d.jersey,statKey:"jersey"}),(0,s.jsx)(q,{label:"Scarf",value:d.scarf,statKey:"scarf"})]}),(0,s.jsxs)("div",{className:r().statsRow,children:[(0,s.jsx)(q,{label:"Flags",value:d.flags,statKey:"flags"}),(0,s.jsx)(q,{label:"Baseball Cap",value:d.baseballCap,statKey:"baseballCap"}),(0,s.jsx)(q,{label:"Other",value:d.other,statKey:"other"})]})]})]}),(0,s.jsxs)("div",{className:r().actions,children:[(0,s.jsx)("button",{className:r().resetButton,onClick:R,children:"Reset Stats"}),(0,s.jsx)("button",{className:r().exportButton,onClick:()=>{let e=new Blob([[["Event Name",a||"Untitled Event"],["Event Date",l],["Generated",new Date().toLocaleString()],[""],["Category","Metric","Count"],["Images","Remote Images",d.remoteImages],["Images","Hostess Images",d.hostessImages],["Images","Selfies",d.selfies],["Images","Total Images",W],["Fans","Indoor",d.indoor],["Fans","Outdoor",d.outdoor],["Fans","Stadium",d.stadium],["Fans","Total Fans",X],["Gender","Female",d.female],["Gender","Male",d.male],["Gender","Total Gender",Z],["Age","Gen Alpha",d.genAlpha],["Age","Gen Y+Z",d.genYZ],["Age","Total Under 40",J],["Age","Gen X",d.genX],["Age","Boomer",d.boomer],["Age","Total Over 40",V],["Age","Total Age",Y],["Merchandise","Merched",d.merched],["Merchandise","Jersey",d.jersey],["Merchandise","Scarf",d.scarf],["Merchandise","Flags",d.flags],["Merchandise","Baseball Cap",d.baseballCap],["Merchandise","Other",d.other],["Merchandise","Total Merch",H]].map(e=>e.join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");if(void 0!==t.download){let s=URL.createObjectURL(e);t.setAttribute("href",s),t.setAttribute("download","".concat(a||"event","_stats_").concat(l,".csv")),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t)}},children:"\uD83D\uDCC4 Download CSV"}),(0,s.jsx)("button",{className:r().googleButton,onClick:()=>{let e=encodeURIComponent([["Event Name:",a||"Untitled Event"],["Event Date:",l],["Generated:",new Date().toLocaleString()],[""],["Category","Metric","Count"],["Images","Remote Images",d.remoteImages],["Images","Hostess Images",d.hostessImages],["Images","Selfies",d.selfies],["Images","Total Images",W],["Fans","Indoor",d.indoor],["Fans","Outdoor",d.outdoor],["Fans","Stadium",d.stadium],["Fans","Total Fans",X],["Gender","Female",d.female],["Gender","Male",d.male],["Gender","Total Gender",Z],["Age","Gen Alpha",d.genAlpha],["Age","Gen Y+Z",d.genYZ],["Age","Total Under 40",J],["Age","Gen X",d.genX],["Age","Boomer",d.boomer],["Age","Total Over 40",V],["Age","Total Age",Y],["Merchandise","Merched",d.merched],["Merchandise","Jersey",d.jersey],["Merchandise","Scarf",d.scarf],["Merchandise","Flags",d.flags],["Merchandise","Baseball Cap",d.baseballCap],["Merchandise","Other",d.other],["Merchandise","Total Merch",H]].map(e=>e.join(",")).join("\n"));window.open("https://docs.google.com/spreadsheets/create?usp=drive_web#paste=".concat(e),"_blank")},children:"\uD83D\uDCCA Export to Google Sheets"})]})]})})}},1145:(e,t,a)=>{Promise.resolve().then(a.bind(a,1057))},5717:e=>{e.exports={main:"page_main__nw1Wk",container:"page_container__jZF7q",fadeInUp:"page_fadeInUp__7IOrd",header:"page_header__oRW75",title:"page_title__po7na",subtitle:"page_subtitle__YBgxm",connectionStatus:"page_connectionStatus__T6fGh",statusIndicator:"page_statusIndicator__q6uCX",pulse:"page_pulse__XPtbN",connected:"page_connected__oJHEE",connecting:"page_connecting__V5pfV",disconnected:"page_disconnected__Jdkhq",error:"page_error__JBrsB",statusText:"page_statusText__6Vir_",lastUpdate:"page_lastUpdate__S84r8",eventInfo:"page_eventInfo__4hyVZ",saveProjectGroup:"page_saveProjectGroup__ECveZ",saveProjectButton:"page_saveProjectButton__mkS2t",projectStatus:"page_projectStatus__evC2X",inputGroup:"page_inputGroup__keP_G",label:"page_label__jI4Tf",input:"page_input__lx_gt",statsGrid:"page_statsGrid__kXg9L",section:"page_section__zQZ2o",sectionTitle:"page_sectionTitle__6ic_4",warningTitle:"page_warningTitle__7if7x",warningPulse:"page_warningPulse__z8iEP",subsection:"page_subsection__RzGW_",subsectionTitle:"page_subsectionTitle__y9U7F",statsRow:"page_statsRow__zReHn",ageGrid:"page_ageGrid__D_byq",ageTotal:"page_ageTotal__erTNN",statCardContainer:"page_statCardContainer__TTrFV",statCard:"page_statCard__WFWBf",decrementButton:"page_decrementButton__7hE27",updating:"page_updating__6hKLd",updatePulse:"page_updatePulse__Nvsh9",calculatedCard:"page_calculatedCard__UI0ZC",warningCard:"page_warningCard__PsNj6",statLabel:"page_statLabel__2jNx3",statValue:"page_statValue__tVgp7",actions:"page_actions___si5r",resetButton:"page_resetButton__uvLeL",exportButton:"page_exportButton__H38q1",googleButton:"page_googleButton__m_IrA",projectControls:"page_projectControls__lmk6i",projectButton:"page_projectButton__Dxm_X",newProjectButton:"page_newProjectButton__N5o1l",saveStatus:"page_saveStatus__XonTM",projectsList:"page_projectsList__0gxMS",projectsGrid:"page_projectsGrid__MicJp",projectCard:"page_projectCard__2LcUe",activeProject:"page_activeProject__EEVkH",projectInfo:"page_projectInfo__xg47N",projectActions:"page_projectActions__XeMTu",loadButton:"page_loadButton__PoukU",deleteButton:"page_deleteButton__nk9u9",realtimeIndicator:"page_realtimeIndicator__3zxxv",inactive:"page_inactive__K9fMU",remoteUpdate:"page_remoteUpdate__GRnkI",collaborativeEditing:"page_collaborativeEditing__FlKce",bounce:"page_bounce__i7ayu"}}},e=>{e.O(0,[938,441,964,358],()=>e(e.s=1145)),_N_E=e.O()}]);