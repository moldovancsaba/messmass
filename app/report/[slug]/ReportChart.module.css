
/* WHAT: ReportChart Component Styles (v12.0.0)
 * WHY: Clean, token-based styling for all chart types
 * HOW: CSS modules with design tokens from theme.css
 */

/* Base Chart Container */
.chart {
  /* WHAT: Flexbox container for consistent internal layout */
  display: flex;
  flex-direction: column;
  width: 100% !important; /* WHAT: Fill parent gridItem horizontally (CRITICAL FIX) */
  max-width: none !important; /* CRITICAL: Remove any max-width constraints */
  height: var(--block-height, var(--row-height, var(--mm-block-height-default))); /* WHAT: Use centrally managed block-height from row, fallback to row-height, then design token (P1 1.4: explicit height cascade, no implicit fallbacks) */
  flex: 1 1 auto; /* CRITICAL: Allow chart to grow and fill space */
  /* REMOVED: min-height - row height is deterministic from block calculator */
  
  /* UNIFIED NAMING: --chartBackground matches database property */
  background: var(--chartBackground) !important;
  border-radius: var(--mm-radius-lg);
  box-shadow: var(--mm-shadow-sm);
  padding: 0; /* WHAT: Remove padding, add to header/body instead */
  overflow: hidden; /* WHAT: Prevent content overflow */
  box-sizing: border-box !important;
  /* Enable container queries for inner scaling (width + height) */
  container-type: size;
  /* REMOVED: transition - interferes with container query recalculation */
}

/* Chart Header - Titles and metadata */
.chartHeader {
  padding: var(--mm-space-4) var(--mm-space-5);
  border-bottom: 1px solid var(--chartBorder);
  flex-shrink: 0; /* WHAT: Prevent header from shrinking */
}

/* Chart Body - Main content area */
.chartBody {
  flex: 1; /* WHAT: Expand to fill available space */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: center;
  padding: var(--mm-space-2);
  min-height: 0; /* WHAT: Allow flex shrinking if needed */
}

/* Chart Title - Standardized across all types */
.chartTitle {
  /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of independent scaling */
  font-size: var(--block-base-font-size);
  font-weight: var(--mm-font-weight-semibold);
  color: var(--chartTitleColor);
  margin: 0;
  line-height: 1.2;
  text-align: center; /* WHAT: Center align chart titles */
}

/* No Data State */
.noData {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%; /* Fill parent height */
  background: var(--chartNoDataBackground);
  border: 2px dashed var(--chartNoDataBorder);
}

.noDataContent {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--mm-space-2);
  color: var(--chartNoDataText);
}

.noDataIcon {
  font-size: var(--mm-font-size-3xl);
  opacity: 0.5;
}

.noDataText {
  font-size: var(--mm-font-size-base);
  font-weight: var(--mm-font-weight-medium);
}

.noDataLabel {
  font-size: var(--mm-font-size-sm);
  color: var(--chartNoDataText);
}

/* KPI Chart - 3-row grid: Icon (40%), Value (30%), Title (30%) */
.kpi {
  /* WHAT: Full height cell with internal 3-row grid (4fr:3fr:3fr = 40%:30%:30%) */
  /* WHY: Larger icon section for visual impact */
  /* HOW: Direct grid layout with vertical centering for all content */
  height: var(--block-height, var(--row-height, var(--mm-block-height-default))); /* WHAT: Use centrally managed block-height from row, fallback to design token (P1 1.4: explicit height cascade, no implicit fallbacks) */
  display: grid;
  grid-template-rows: 4fr 3fr 3fr; /* Icon (top 40%) : Value (middle 30%) : Title (bottom 30%) */
  gap: 0;
  width: 100%;
  box-sizing: border-box;
  align-items: center; /* CRITICAL: Vertically center content in each row */
  justify-items: center; /* CRITICAL: Horizontally center content */
}

.kpiIconRow {
  /* WHAT: Grid row 1 (40%) for icon */
  /* WHY: First row of 4fr-3fr-3fr grid */
  /* HOW: Flex centering with container queries, fully centered vertically */
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  container-type: size;
}

.kpiIcon {
  /* WHAT: Material Icons scale by font-size, 85% of icon row */
  /* WHY: Visual impact - large icon dominates top 40% */
  /* HOW: Container query on .kpiIconRow, vertically centered */
  font-size: clamp(2.5rem, 85cqh, 7rem) !important; /* 85% of icon row height */
  height: auto !important;
  width: auto !important;
  color: var(--kpiIconColor) !important;
  line-height: 1 !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
}

.kpiValueRow {
  /* WHAT: Grid row 2 (30%) for value */
  /* WHY: Middle row of 4fr-3fr-3fr grid */
  /* HOW: Flex centering for responsive value scaling, fully vertically centered */
  /* P1 2.5.1: Increased scaling from min(18cqh, 20cqw) to min(30cqh, 25cqw), max from 5rem to 6rem */
  /* A-03.2: Enhanced to prevent value clipping */
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  font-size: clamp(1.25rem, min(30cqh, 25cqw), 6rem); /* INCREASED: 18cqh→30cqh, 20cqw→25cqw, 5rem→6rem */
  font-weight: var(--mm-font-weight-bold);
  color: var(--chartValueColor);
  line-height: 0.85;
  text-align: center;
  letter-spacing: -0.04em;
  /* WHAT: A-03.2 - Allow wrapping instead of truncation - Layout Grammar: no truncation on content */
  /* WHY: Content must fit through wrapping/reflow, not truncation */
  /* HOW: Enhanced wrapping properties to ensure multi-line values fit */
  word-wrap: break-word !important;
  overflow-wrap: break-word !important;
  hyphens: auto !important; /* A-03.2: Allow hyphenation for better value fitting */
  /* WHAT: A-03.2 - Ensure value fits within row height */
  /* WHY: Multi-line values must be fully visible, not clipped */
  /* HOW: Use min-height: 0 to allow flex shrinking, overflow: hidden to prevent overflow */
  min-height: 0 !important; /* CRITICAL: Allow flex shrinking to fit content */
  overflow: hidden !important; /* A-03.2: Prevent overflow - content must wrap to fit (Layout Grammar) */
  container-type: size;
}

.kpi .kpiTitle {
  /* WHAT: 3rd grid row (30%) - title at bottom of KPI */
  /* WHY: Grid row 3 = bottom 30% of cell */
  /* HOW: Flex with center alignment - fully vertically centered */
  /* P1 2.5.1: Increased scaling from 8cqh to 15cqh, max from 1.125rem to 1.5rem */
  /* A-03.2: Enhanced to prevent title clipping */
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  width: 100%;
  height: 100%;
  padding: var(--mm-space-2);
  /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of independent scaling */
  font-size: var(--block-base-font-size);
  font-weight: var(--mm-font-weight-medium);
  color: var(--chartLabelColor);
  line-height: 1.1;
  /* WHAT: A-03.2 - Enhanced wrapping to ensure title fits */
  /* WHY: Title must fit within allocated row height (clamped to 2 lines per Layout Grammar) */
  /* HOW: Enhanced wrapping properties */
  word-break: break-word !important;
  word-wrap: break-word !important;
  overflow-wrap: break-word !important;
  hyphens: auto !important; /* A-03.2: Allow hyphenation for better title fitting */
  /* WHAT: A-03.2 - Ensure title fits within row height */
  /* WHY: Title is clamped to 2 lines per Layout Grammar, but must fit within allocated height */
  /* HOW: Use min-height: 0 to allow flex shrinking, overflow: hidden to prevent overflow */
  min-height: 0 !important; /* CRITICAL: Allow flex shrinking to fit content */
  overflow: hidden !important; /* A-03.2: Prevent overflow - title must clamp to 2 lines (Layout Grammar) */
}

.kpi .kpiTitle > * {
  /* WHAT: Inner content wrapper for text truncation */
  /* WHY: Allows flex centering while maintaining line clamp */
  /* HOW: Use -webkit-box for line clamping inside flex container */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 2;
  overflow: hidden;
  text-align: center;
  width: 100%;
}

/* Pie Chart - Uses base .chart structure */

/* Container grid for title, pie, legend - CSS Grid layout (table-style) */
.pieGrid {
  /* WHAT: CSS Grid layout (same as KPI charts) to prevent overflow on mobile */
  /* WHY: Fixed proportions ensure content stays within frame, no overflow */
  /* HOW: Use grid-template-rows with fixed proportions (3fr:4fr:3fr = 30%:40%:30%) */
  height: 100%;
  width: 100%;
  display: grid;
  grid-template-rows: 3fr 4fr 3fr; /* Title (30%) : Pie (40%) : Legend (30%) */
  gap: 0;
  align-items: stretch;
  justify-items: stretch;
}

/* Title row: Grid row 1 (30% of cell), vertically centered */
.pieTitleRow {
  /* WHAT: Grid row 1 - fixed 30% proportion */
  /* WHY: CSS Grid ensures fixed proportion, no flex competition */
  /* HOW: Grid row with flex centering for content */
  display: flex;
  align-items: center;
  justify-content: center;
  padding: var(--mm-space-1) var(--mm-space-2);
  min-height: 0; /* CRITICAL: Allow grid row to shrink if needed */
  overflow: hidden; /* Prevent overflow */
}

.pieTitleText {
  margin: 0;
  text-align: center;
  font-weight: var(--mm-font-weight-semibold);
  color: var(--chartTitleColor);
  /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of independent scaling */
  font-size: var(--block-base-font-size);
  line-height: 1.2;
}

/* Pie Chart - Uses base .chart structure */
.pie .chartBody {
  /* WHAT: Flex column with 40:40:20 split (title:pie:legend) */
  /* WHY: Balanced proportions for all elements */
  /* HOW: Use flex-basis for fixed height proportions */
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: 0;
  height: 100%;
  width: 100%;
  container-type: size;
  align-items: stretch;
  justify-content: flex-start;
}

.pieTitle {
  /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of independent scaling */
  font-size: var(--block-base-font-size);
  font-weight: var(--mm-font-weight-semibold);
  color: var(--chartTitleColor);
  margin-bottom: var(--mm-space-1);
  text-align: center;
}

.pieSegments {
  display: flex;
  gap: var(--mm-space-1);
  justify-content: center;
}

.pieSegment {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--mm-space-2);
}

.pieColor {
  width: 32px;
  height: 32px;
  border-radius: var(--mm-radius-full);
  box-shadow: var(--mm-shadow-sm);
}

.pieLabel {
  /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of independent scaling */
  font-size: var(--block-base-font-size);
  color: var(--chartLabelColor);
  font-weight: var(--mm-font-weight-medium);
}

.pieValue {
  font-size: clamp(1rem, 3cqw, 1.4rem);
  font-weight: var(--mm-font-weight-bold);
  color: var(--chartValueColor);
}

.piePercent {
  font-size: var(--mm-font-size-sm);
  color: var(--chartLabelColor);
}

/* Pie Chart Container for Chart.js - Uses measured body height */
.pieChartContainer {
  /* WHAT: A-03.4 - Uses measured body height via --chart-body-height CSS variable */
  /* WHY: Guaranteed height (not competing flex) - KPI-safe pattern */
  /* HOW: JavaScript calculates bodyHeight = containerHeight - titleHeight - legendHeight, sets CSS variable */
  height: var(--chart-body-height, 40%); /* WHAT: Use measured height, fallback to 40% for initial render */
  width: 100%;
  min-height: 0; /* WHAT: Allow flex shrinking if needed */
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  container-type: size;
  overflow: visible; /* WHAT: P1 1.6 - Layout Grammar: no clipping on content layers, Chart.js canvas must be fully visible */
}

/* Custom Pie Legend - Grid row 3 (30% of cell) */
.pieLegend {
  /* WHAT: Grid row 3 - fixed 30% proportion (CSS Grid layout) */
  /* WHY: CSS Grid ensures fixed proportion, no flex competition or overflow */
  /* HOW: Grid row with flex column for legend items */
  display: flex;
  flex-direction: column;
  justify-content: flex-start; /* WHAT: Changed from center to flex-start to prevent clipping in constrained blocks */
  align-items: center;
  gap: clamp(0.125rem, 1cqh, var(--mm-space-1)); /* WHAT: Responsive gap - smaller in constrained spaces */
  width: 100%;
  min-height: 0; /* CRITICAL: Allow grid row to shrink if needed */
  container-type: size;
  overflow: visible; /* WHAT: Layout Grammar: content must be visible */
  padding: clamp(0.125rem, 1cqh, var(--mm-space-1)); /* WHAT: Responsive padding - smaller in constrained spaces */
  box-sizing: border-box;
}

.pieLegendItem {
  /* WHAT: Flex container for legend item with colored square */
  /* WHY: Display indicator + label in horizontal layout, centered */
  /* HOW: Flex with center alignment for both vertical and horizontal centering */
  display: flex;
  align-items: center;
  justify-content: center; /* WHAT: Center legend items horizontally */
  gap: var(--mm-space-2);
  width: auto; /* WHAT: Auto width to allow centering as a group */
  /* Remove fixed height so items don't stretch; rely on content and legend container */
}

.pieLegendDot {
  /* WHAT: Colored SQUARE (not dot) matching pie slice color */
  /* WHY: Visual indicator of which legend item corresponds to which pie slice */
  /* HOW: Square shape scaled to fit available space, no border radius */
  width: clamp(0.7rem, 6cqh, 1rem); /* Reduced: 10cqh → 6cqh to prevent overflow */
  height: clamp(0.7rem, 6cqh, 1rem);
  border-radius: 0; /* SQUARE, not circle */
  flex-shrink: 0;
  box-sizing: border-box;
  /* WHAT: Dynamic colors from CSS custom properties set on parent */
  /* WHY: Colors come from chart data, cannot use static CSS classes */
  background-color: var(--dot-color, var(--pieColor1, var(--mm-color-primary-500)));
  /* WHAT: Border color and width match pie chart border (2px solid first pie color) */
  border: 2px solid var(--dot-border-color, var(--pieColor1, var(--mm-color-primary-500)));
}

.pieLegendText {
  /* WHAT: Legend text scaled to fit available space with responsive sizing */
  /* WHY: Make legend text readable in both large and small blocks, prevent overflow, fill available space */
  /* HOW: Use container queries for both width and height, design tokens for bounds */
  /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of independent scaling */
  font-size: var(--block-base-font-size);
  font-weight: var(--mm-font-weight-medium);
  color: var(--chartLabelColor);
  line-height: 1.2; /* WHAT: Reduced from 1.3 to 1.2 for tighter spacing in constrained blocks */
  /* WHAT: Allow wrapping instead of truncation - Layout Grammar: no truncation on content */
  /* WHY: Content must fit through wrapping/reflow, not truncation */
  word-wrap: break-word;
  overflow-wrap: break-word;
  flex: 0 1 auto; /* WHAT: Don't grow, allow shrink, auto width for centering */
}

/* Bar Chart - Uses base .chart structure */
.bar .chartBody {
  /* WHAT: Chart body container - fills available space, respects height constraints */
  /* WHY: Must use full width and respect available height without overflow */
  /* HOW: Flex container with width/height constraints, table fills available space and is centered */
  /* CRITICAL: Layout Grammar - no scrolling, no truncation, no clipping on content layers */
  height: 100%; /* WHAT: Fill parent body zone height (explicit height from --chart-body-height) */
  padding: var(--mm-space-2);
  display: flex;
  flex-direction: column;
  align-items: center; /* WHAT: Center table horizontally in container */
  justify-content: center; /* WHAT: Center table vertically in container */
  min-height: 0;
  width: 100% !important; /* CRITICAL: Use full width */
  max-width: 100% !important; /* CRITICAL: Never exceed container width */
  overflow: visible; /* WHAT: Layout Grammar - no clipping on content layers, content must be visible, container grows to fit */
  box-sizing: border-box;
}

.barTitle {
  /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of independent scaling */
  font-size: var(--block-base-font-size);
  font-weight: var(--mm-font-weight-semibold);
  color: var(--chartTitleColor);
  margin-bottom: var(--mm-space-1);
  flex-shrink: 0; /* WHAT: Prevent title from shrinking */
}

.barTable {
  /* WHAT: BAR chart table - semantic HTML table for natural row expansion */
  /* WHY: Tables naturally expand rows to fit content, preventing overlap (Layout Grammar: no clipping) */
  /* HOW: Standard HTML table with proper column widths, rows expand automatically, centered in container */
  /* CRITICAL: Layout Grammar - no scrolling, no clipping, content must fit through structural changes (reflow/aggregation/height increase) */
  width: 100%; /* WHAT: Use full width of available space (accounts for parent padding via box-sizing) */
  max-width: 100%; /* WHAT: Never exceed container width */
  border-collapse: separate;
  border-spacing: 0 var(--mm-space-2); /* WHAT: Consistent row gap using border-spacing - increased for better visual separation */
  table-layout: fixed; /* WHAT: Fixed layout for consistent column widths, respects width: 100% */
  height: auto; /* WHAT: Auto height to fit all rows - Layout Grammar: content must fit through structural changes, not clipping */
  margin: 0 auto; /* WHAT: Center table horizontally in flex container */
  box-sizing: border-box;
  /* WHAT: Removed max-height constraint - Layout Grammar: if content doesn't fit, apply reflow/aggregation/height increase, not clipping */
}

.barElements {
  /* WHAT: Table body - contains all bar rows */
  /* WHY: Standard table structure */
  width: 100%;
  display: table-row-group; /* WHAT: Ensure proper table structure */
  /* WHAT: Table body naturally fits within table height constraints */
}

.barRow {
  /* WHAT: Table row - naturally expands to fit content */
  /* WHY: Table rows automatically expand to fit tallest cell content */
  /* HOW: Standard table row, no special CSS needed for row expansion */
  /* A-03.3: Enhanced to ensure rows accommodate measured label heights */
  vertical-align: top; /* WHAT: Align content to top of row */
  /* WHAT: A-03.3 - Ensure row height accommodates measured label heights */
  /* WHY: Row height must accommodate actual rendered label height (not fixed assumptions) */
  /* HOW: Table rows naturally expand, but we ensure no clipping */
  min-height: 0 !important; /* CRITICAL: Allow natural expansion */
}

.barLabel {
  /* WHAT: Bar label table cell - wraps naturally, row expands automatically */
  /* WHY: Table cells naturally expand row height when content wraps (Layout Grammar: no clipping) */
  /* HOW: Standard table cell with natural text wrapping, right-aligned, no forced line limits */
  /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of independent scaling */
  /* A-03.3: Enhanced to prevent label clipping with measured layout logic */
  font-size: var(--block-base-font-size);
  color: var(--chartLabelColor);
  font-weight: var(--mm-font-weight-medium);
  text-align: right;
  white-space: normal !important; /* WHAT: Allow natural wrapping */
  overflow-wrap: anywhere !important; /* WHAT: Break words if needed to prevent overflow */
  word-break: break-word !important; /* WHAT: Break long words if needed */
  hyphens: auto !important; /* A-03.3: Allow hyphenation for better label fitting */
  line-height: 1.2; /* WHAT: Comfortable line-height for readability */
  padding-right: var(--mm-space-2);
  padding-left: var(--mm-space-1);
  width: 40%; /* WHAT: Generous label column width - 40% of table width for full label visibility */
  vertical-align: top; /* WHAT: Align to top of row */
  box-sizing: border-box;
  /* WHAT: A-03.3 - Ensure labels fit without clipping */
  /* WHY: Labels must wrap to fit within allocated row height (Layout Grammar) */
  /* HOW: Use min-height: 0 to allow natural expansion, overflow: visible to prevent clipping */
  min-height: 0 !important; /* CRITICAL: Allow natural expansion */
  overflow: visible !important; /* A-03.3: Prevent clipping - labels must be visible */
  /* WHAT: Removed line-clamp - let labels wrap naturally to fit available space (max 2 lines enforced by font size calculation) */
}

.barTrackCell {
  /* WHAT: Bar track table cell - contains the bar visualization */
  /* WHY: Table cell provides natural column structure */
  /* HOW: Standard table cell, contains barTrack div - fills remaining space after label and value */
  padding: 0 var(--mm-space-2);
  width: 1fr; /* WHAT: Track column fills remaining space (with fixed layout, auto width fills remaining) */
  vertical-align: middle; /* WHAT: Center bar vertically in row */
  box-sizing: border-box;
}

.barTrack {
  /* WHAT: Bar track visualization - fills available space in table cell */
  /* WHY: Track fills available space between label and value, must maintain readable thickness */
  /* HOW: 100% width of table cell, minimum height constraint, centered vertically */
  background: var(--chartNoDataBackground);
  height: clamp(1.2rem, 22cqh, 1.44rem); /* DOUBLED: 11cqh → 22cqh */
  min-height: clamp(1.2rem, 22cqh, 1.44rem); /* WHAT: Prevent bar collapse under vertical constraint */
  width: 100%; /* CRITICAL: Fills entire table cell */
  border-radius: calc(clamp(1.2rem, 22cqh, 1.44rem) / 2);
  overflow: hidden;
  /* WHAT: Table cell vertical-align handles centering, no align-self needed */
}

.barFill {
  /* WHAT: Fills track based on percentage of max value */
  /* WHY: Visual representation of bar data */
  /* HOW: Width and color set via CSS custom properties from parent */
  height: 100%;
  width: var(--bar-width, 0%);
  background-color: var(--bar-color, var(--barColor1, var(--mm-color-primary-500)));
  border-radius: calc(clamp(1.2rem, 22cqh, 1.44rem) / 2);
  transition: width var(--transition-normal);
}

.barValue {
  /* WHAT: Bar value table cell - displays formatted number */
  /* WHY: Table cell provides natural column structure */
  /* HOW: Standard table cell, left-aligned text - same font size as label */
  padding-left: var(--mm-space-2);
  padding-right: var(--mm-space-1);
  width: auto; /* WHAT: Value column auto-width based on content, remaining space goes to track */
  min-width: fit-content; /* WHAT: Ensure value text is never clipped */
  font-size: var(--block-base-font-size); /* WHAT: Same font size as label for consistency */
  font-weight: var(--mm-font-weight-bold);
  color: var(--chartValueColor);
  text-align: left;
  line-height: 1.2; /* WHAT: Match label line-height */
  white-space: nowrap; /* WHAT: Values should not wrap (single line) */
  vertical-align: middle; /* WHAT: Center value vertically in row */
  box-sizing: border-box;
}

/* Text Chart - Flexbox structure with title and content zones */
.text {
  /* CRITICAL: Use flexbox column to stack title and content */
  display: flex !important;
  flex-direction: column !important;
  width: 100% !important;
  height: 100% !important; /* WHAT: Fill parent row height from layout grammar */
  /* CRITICAL: Ensure children stack vertically */
  position: relative !important;
  min-height: 0 !important; /* CRITICAL: Allow flex shrinking */
}

.textTitleWrapper {
  /* WHAT: Title container - top of chart, fixed height */
  /* WHY: Separate block-level div that cannot be inline */
  display: block !important;
  width: 100% !important;
  height: auto !important;
  min-height: 0 !important;
  max-height: 30% !important; /* Limit title to max 30% of container */
  padding: var(--mm-space-2) !important;
  box-sizing: border-box !important;
  /* CRITICAL: Force block display - cannot be inline */
  clear: both !important;
  float: none !important;
}

.textTitleText {
  margin: 0 !important;
  padding: 0 !important;
  text-align: center !important;
  font-weight: var(--mm-font-weight-semibold) !important;
  color: var(--chartTitleColor) !important;
  /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of independent scaling */
  font-size: var(--block-base-font-size) !important;
  line-height: 1.25 !important;
  display: -webkit-box !important;
  -webkit-box-orient: vertical !important;
  -webkit-line-clamp: 2 !important;
  overflow: hidden !important;
  word-break: break-word !important;
  width: 100% !important;
  box-sizing: border-box !important;
}

.textContentWrapper {
  /* WHAT: Content container - fills remaining space after title, centers content vertically and horizontally */
  /* WHY: Separate block-level div that cannot be inline, must fill available space and center content */
  /* P1 1.4 Phase 4: Explicit height instead of flex: 1 */
  /* A-03.1: Enhanced to prevent content clipping */
  display: flex !important; /* CRITICAL: Use flexbox for vertical centering */
  align-items: center !important; /* CRITICAL: Center content vertically */
  justify-content: center !important; /* CRITICAL: Center content horizontally */
  width: 100% !important;
  height: var(--text-content-height, var(--mm-block-height-default)); /* WHAT: P1 1.4 Phase 4 - explicit height from calculation, fallback to design token */
  padding: var(--mm-space-2) !important;
  box-sizing: border-box !important;
  /* WHAT: A-03.1 - Ensure content fits without clipping */
  /* WHY: Multi-line text must be fully visible within the wrapper */
  /* HOW: Use min-height: 0 to allow flex shrinking, ensure content wraps to fit */
  min-height: 0 !important; /* CRITICAL: Allow flex shrinking to fit content */
  overflow: hidden !important; /* A-03.1: Prevent overflow - content must wrap to fit (Layout Grammar) */
  /* CRITICAL: Force block display - cannot be inline */
  clear: both !important;
  float: none !important;
  /* CRITICAL: Ensure this is below title */
  position: relative !important;
  /* CRITICAL: Enable container queries for font scaling */
  container-type: size !important;
}

.textContent {
  /* WHAT: Container for markdown content - fills available space and centers content */
  /* WHY: Markdown elements (p, h1, etc.) must stack vertically, fill space, and be centered */
  /* HOW: Use flexbox to fill space and center content, block display for children to stack */
  /* P1 1.4 Phase 4: Explicit height instead of min-height: 0 */
  /* A-03.1: Enhanced to prevent multi-line text clipping */
  display: flex !important; /* CRITICAL: Use flexbox to fill space and center content */
  flex-direction: column !important; /* CRITICAL: Stack children vertically */
  align-items: center !important; /* CRITICAL: Center content horizontally */
  justify-content: center !important; /* CRITICAL: Center content vertically */
  width: 100% !important;
  max-width: 100% !important;
  height: 100% !important; /* CRITICAL: Fill parent height completely (parent has explicit height from Phase 4) */
  max-height: 100% !important; /* CRITICAL: Don't exceed parent height */
  /* WHAT: A-03.1 - Ensure content fits without clipping */
  /* WHY: Multi-line text and tables must be fully visible, not clipped */
  /* HOW: Use min-height: 0 to allow flex shrinking, dynamic font size reduction for tables */
  min-height: 0 !important; /* CRITICAL: Allow flex shrinking to fit content */
  overflow: hidden !important; /* A-03.1: Prevent overflow - content must fit through font size reduction (Layout Grammar) */
  /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of unified-text-font-size (Option B) */
  /* WHY: Align text chart typography with block typography for true unification */
  /* A-03.1: Font size may be reduced dynamically via inline style if content exceeds space */
  font-size: var(--block-base-font-size) !important;
  font-weight: var(--mm-font-weight-semibold);
  color: var(--textColor);
  line-height: 1.3;
  box-sizing: border-box;
  /* CRITICAL: Center the entire block of content */
  text-align: center !important;
  /* CRITICAL: No scrolling, no clipping - Layout Grammar compliance (content must fit through wrapping/reflow/font reduction) */
  /* WHAT: Content must fit through structural change (wrapping, reflow, font size reduction), not clipping */
  /* WHY: Layout Grammar: no clipping on content layers, no scrolling */
  /* A-03.1: Enhanced wrapping for text, dynamic font size reduction for tables */
  word-wrap: break-word !important;
  overflow-wrap: break-word !important;
  hyphens: auto !important; /* A-03.1: Allow hyphenation for better text fitting */
  /* CRITICAL: Enable container queries for responsive scaling (fallback) */
  container-type: size !important;
}

/* WHAT: Markdown element styles inside text content
 * WHY: Support full markdown features with center alignment
 * HOW: Use relative font sizes (em) so they inherit container scaling
 * CRITICAL: All block elements must be display: block to stack vertically, center-aligned
 */

/* WHAT: Heading levels with relative sizes (h1-h6) */
/* WHY: Preserve heading hierarchy while maintaining center alignment */
/* HOW: Use relative font sizes (em) that inherit from .textContent base size */
.textMarkdown h1 {
  display: block !important;
  margin: 0.5em 0 !important;
  padding: 0 !important;
  font-weight: 700 !important;
  line-height: 1.2 !important;
  font-size: 1.5em !important; /* WHAT: Largest heading - 1.5x base size */
  width: 100% !important;
  box-sizing: border-box !important;
  color: inherit !important;
  text-align: center !important;
}

.textMarkdown h2 {
  display: block !important;
  margin: 0.5em 0 !important;
  padding: 0 !important;
  font-weight: 700 !important;
  line-height: 1.2 !important;
  font-size: 1.3em !important; /* WHAT: Second level - 1.3x base size */
  width: 100% !important;
  box-sizing: border-box !important;
  color: inherit !important;
  text-align: center !important;
}

.textMarkdown h3 {
  display: block !important;
  margin: 0.5em 0 !important;
  padding: 0 !important;
  font-weight: 700 !important;
  line-height: 1.2 !important;
  font-size: 1.1em !important; /* WHAT: Third level - 1.1x base size */
  width: 100% !important;
  box-sizing: border-box !important;
  color: inherit !important;
  text-align: center !important;
}

.textMarkdown h4 {
  display: block !important;
  margin: 0.5em 0 !important;
  padding: 0 !important;
  font-weight: 600 !important;
  line-height: 1.2 !important;
  font-size: 1.05em !important; /* WHAT: Fourth level - 1.05x base size */
  width: 100% !important;
  box-sizing: border-box !important;
  color: inherit !important;
  text-align: center !important;
}

.textMarkdown h5 {
  display: block !important;
  margin: 0.5em 0 !important;
  padding: 0 !important;
  font-weight: 600 !important;
  line-height: 1.2 !important;
  font-size: 1em !important; /* WHAT: Fifth level - same as base size */
  width: 100% !important;
  box-sizing: border-box !important;
  color: inherit !important;
  text-align: center !important;
}

.textMarkdown h6 {
  display: block !important;
  margin: 0.5em 0 !important;
  padding: 0 !important;
  font-weight: 600 !important;
  line-height: 1.2 !important;
  font-size: 0.95em !important; /* WHAT: Smallest heading - 0.95x base size */
  width: 100% !important;
  box-sizing: border-box !important;
  color: inherit !important;
  text-align: center !important;
}

.textMarkdown p {
  display: block !important; /* CRITICAL: Force block display */
  margin: 0 0 0.5em 0 !important;
  padding: 0 !important;
  width: 100% !important;
  box-sizing: border-box !important;
  font-size: 1em !important; /* CRITICAL: Explicit same size (inherit from .textContent) */
}

.textMarkdown p:last-child {
  margin-bottom: 0 !important;
}

.textMarkdown strong { 
  font-weight: 700 !important;
  display: inline !important; /* Bold stays inline within block */
}

.textMarkdown em { 
  font-style: italic !important;
  display: inline !important; /* Italic stays inline within block */
}

.textMarkdown ul,
.textMarkdown ol {
  display: block !important; /* CRITICAL: Force block display */
  margin: 0.5em 0 !important;
  padding-left: 1.5em !important; /* indent markers */
  text-align: left !important; /* lists read better left-aligned */
  width: 100% !important;
  box-sizing: border-box !important;
  font-size: 1em !important; /* CRITICAL: Same size as content */
}

.textMarkdown li { 
  display: list-item !important; /* CRITICAL: Force list-item display */
  margin: 0.15em 0 !important;
  font-size: 1em !important; /* CRITICAL: Same size as content */
}

.textMarkdown a { 
  color: var(--mm-blue-600) !important; 
  text-decoration: underline !important;
  display: inline !important; /* Links stay inline */
}

.textMarkdown a:hover { 
  color: var(--mm-blue-700) !important; 
}

/* CRITICAL: Ensure all markdown content is block-level by default */
.textMarkdown {
  display: flex !important; /* CRITICAL: Use flexbox to fill space and center content */
  flex-direction: column !important; /* CRITICAL: Stack children vertically */
  align-items: center !important; /* CRITICAL: Center content horizontally */
  justify-content: center !important; /* CRITICAL: Center content vertically */
  width: 100% !important;
  height: 100% !important; /* CRITICAL: Fill parent height */
  min-height: 0 !important; /* CRITICAL: Allow flex shrinking */
  box-sizing: border-box !important;
  /* CRITICAL: Allow children to stack vertically */
  text-align: center !important;
  /* CRITICAL: All markdown elements inherit same font-size from .textContent */
  font-size: inherit !important;
  /* CRITICAL: Preserve line breaks but allow wrapping (not pre-wrap which breaks bold) */
  white-space: normal !important; /* Allow normal wrapping, markdown handles line breaks */
  overflow: hidden !important; /* A-03.1: Prevent overflow - content must fit through font size reduction (Layout Grammar) */
}

.textMarkdown > * {
  display: block !important; /* CRITICAL: All direct children are blocks */
  width: 100% !important;
  flex-shrink: 0 !important; /* CRITICAL: Don't shrink markdown elements */
  box-sizing: border-box !important;
  text-align: center !important; /* Center each block */
  font-size: 1em !important; /* CRITICAL: Same size for all elements */
}

/* A-03.1 FIX: Table styling in text markdown - tables need special handling */
.textMarkdown table {
  width: 100% !important;
  max-width: 100% !important;
  border-collapse: collapse !important;
  margin: 0.5em 0 !important;
  display: table !important; /* CRITICAL: Tables must be display: table */
  text-align: left !important; /* Tables read better left-aligned */
  font-size: 0.9em !important; /* Slightly smaller font for tables to fit more rows */
}

.textMarkdown table thead {
  background: var(--chartTitleColor, var(--mm-gray-100)) !important;
  font-weight: var(--mm-font-weight-semibold) !important;
}

.textMarkdown table th,
.textMarkdown table td {
  padding: var(--mm-space-2) var(--mm-space-3) !important;
  border: 1px solid var(--chartBorder, var(--mm-gray-200)) !important;
  text-align: left !important;
}

.textMarkdown table th {
  border-bottom: 2px solid var(--chartBorder, var(--mm-gray-300)) !important;
}

/* WHAT: Remove duplicate h1 definition - already defined above with proper sizing */

/* WHAT: Blockquote styling with center alignment */
/* WHY: Support blockquotes with visual distinction */
.textMarkdown blockquote {
  display: block !important;
  margin: 0.5em 0 !important;
  padding: 0.5em 1em !important;
  border-left: 3px solid var(--mm-gray-300) !important;
  background: var(--mm-gray-50) !important;
  border-radius: var(--mm-radius-sm) !important;
  font-style: italic !important;
  width: 100% !important;
  box-sizing: border-box !important;
  text-align: center !important;
  font-size: 1em !important;
  color: inherit !important;
}

/* WHAT: Code block styling with center alignment */
/* WHY: Support code blocks with monospace font */
/* Layout Grammar: No scrolling - wrap long lines instead */
.textMarkdown pre {
  display: block !important;
  margin: 0.5em 0 !important;
  padding: 0.5em !important;
  background: var(--mm-gray-100) !important;
  border-radius: var(--mm-radius-sm) !important;
  /* WHAT: Wrap long lines instead of scrolling - Layout Grammar compliance */
  /* WHY: Content must fit without scrolling */
  white-space: pre-wrap !important; /* Wrap long lines */
  word-break: break-all !important; /* Break long words if needed */
  overflow: hidden !important; /* No scrolling allowed */
  width: 100% !important;
  box-sizing: border-box !important;
  text-align: left !important; /* WHAT: Code blocks left-aligned for readability */
  font-size: 0.9em !important;
  font-family: 'Courier New', Courier, monospace !important;
}

/* WHAT: Inline code styling */
/* WHY: Support inline code with monospace font */
.textMarkdown code {
  font-family: 'Courier New', Courier, monospace !important;
  font-size: 0.9em !important;
  background: var(--mm-gray-100) !important;
  padding: 0.15em 0.3em !important;
  border-radius: var(--mm-radius-xs) !important;
  display: inline !important;
}

/* WHAT: Code block code (nested in pre) */
/* WHY: Code blocks use pre>code structure */
.textMarkdown pre code {
  display: block !important;
  background: transparent !important;
  padding: 0 !important;
  font-size: 1em !important;
}

/* WHAT: Strikethrough styling */
/* WHY: Support strikethrough text decoration */
.textMarkdown del,
.textMarkdown s {
  text-decoration: line-through !important;
  display: inline !important;
  color: var(--mm-gray-500) !important;
}

/* WHAT: Horizontal rule styling */
/* WHY: Support horizontal rules for visual separation */
.textMarkdown hr {
  display: block !important;
  border: none !important;
  border-top: 1px solid var(--mm-gray-300) !important;
  margin: 1em 0 !important;
  width: 100% !important;
  box-sizing: border-box !important;
}

/* Override for inline elements (they stay inline within their block parent) */
.textMarkdown strong,
.textMarkdown em,
.textMarkdown a,
.textMarkdown code:not(pre code),
.textMarkdown del,
.textMarkdown s {
  display: inline !important;
  width: auto !important;
  text-align: inherit !important;
}

/* Table Chart - Markdown table display */
.table {
  background: var(--chartBackground) !important;
  border-radius: var(--mm-radius-lg);
}

.tableContent {
  width: 100%;
  height: var(--text-content-height, var(--mm-block-height-default)); /* WHAT: P1 1.4 Phase 4 - explicit height from calculation (uses --chart-body-height from Phase 2), fallback to design token */
  /* WHAT: No clipping - Layout Grammar: content must fit through wrapping/reflow */
  /* WHY: Layout Grammar: no clipping on content layers */
  padding: var(--mm-space-4);
  display: flex;
  flex-direction: column;
}

.tableMarkdown {
  width: 100%;
  height: 100%; /* WHAT: Fill parent tableContent height (explicit height from Phase 4) */
  /* WHAT: No clipping - Layout Grammar: content must fit through wrapping/reflow */
  /* WHY: Layout Grammar: no clipping on content layers */
  display: flex;
  flex-direction: column;
}

.tableMarkdown table {
  width: 100%;
  border-collapse: collapse;
  border-spacing: 0;
  margin: 0;
  /* WHAT: P1 1.5 Phase 2 - Use block-level typography instead of independent scaling */
  font-size: var(--block-base-font-size);
  table-layout: auto;
}

.tableMarkdown table thead {
  background: var(--chartTitleColor, var(--mm-gray-100));
  font-weight: var(--mm-font-weight-semibold);
}

.tableMarkdown table th {
  padding: var(--mm-space-3) var(--mm-space-4);
  text-align: left;
  border-bottom: 2px solid var(--chartBorder, var(--mm-gray-300));
  color: var(--chartValueColor, var(--mm-gray-900));
}

.tableMarkdown table td {
  padding: var(--mm-space-3) var(--mm-space-4);
  border-bottom: 1px solid var(--chartBorder, var(--mm-gray-200));
  color: var(--chartValueColor, var(--mm-gray-900));
}

.tableMarkdown table tbody tr:hover {
  background: var(--mm-gray-50);
}

.tableMarkdown table tbody tr:last-child td {
  border-bottom: none;
}

/* Table markdown content styling */
.tableMarkdown p {
  margin: 0 0 0.5em 0;
}

.tableMarkdown strong { font-weight: 700; }
.tableMarkdown em { font-style: italic; }

.tableMarkdown a { color: var(--mm-blue-600); text-decoration: underline; }
.tableMarkdown a:hover { color: var(--mm-blue-700); }

/* Image Chart - Container */
/* WHAT: Chart container for image charts */
.image {
  background: transparent !important; /* WHAT: No background on chart container, image container has background */
  padding: 0; /* WHAT: No padding, image container handles spacing */
}

/* WHAT: Image container with dynamic aspect ratio from actual image dimensions */
/* WHY: Use real image dimensions instead of configured aspect ratio for accurate display */
/* HOW: Container uses CSS custom property --image-aspect-ratio set dynamically from image naturalWidth/naturalHeight */
.imageContainer {
  background: var(--chartBackground) !important;
  border-radius: var(--mm-radius-lg); /* Rounded corners for image container */
  box-shadow: var(--mm-shadow-sm);
  overflow: hidden !important; /* Clip image to rounded corners */
  display: flex;
  align-items: center;
  justify-content: center;
  /* WHAT: Container fills width, height constrained by actual image aspect ratio */
  /* WHY: Body zone is flex container with center alignment, image should fill available width */
  width: 100%; /* Fill available width in body zone */
  max-width: 100%; /* Don't exceed body zone width */
  max-height: 100%; /* Don't exceed body zone height */
  height: auto; /* Height calculated from aspect ratio */
  /* WHAT: Use CSS custom property for dynamic aspect ratio */
  /* WHY: Aspect ratio is detected from actual image dimensions, not configured value */
  aspect-ratio: var(--image-aspect-ratio, 16 / 9); /* Fallback to 16:9 if not set */
}

/* WHAT: <img> element fills container completely */
/* WHY: Image should fill the aspect-ratio-constrained container */
/* HOW: Use object-fit: contain to show full image without cropping, maintaining aspect ratio */
.imageContent {
  display: block;
  width: 100%; /* Fill container width */
  height: 100%; /* Fill container height */
  object-fit: contain; /* Show full image without cropping, maintaining aspect ratio */
  object-position: center; /* Center the image */
  border-radius: var(--mm-radius-lg); /* Match container rounded corners */
}

/* WHAT: Image container on mobile - same dynamic aspect ratio approach */
/* WHY: Consistent behavior across breakpoints */
@media (max-width: 768px) {
  .imageContainer {
    width: 100% !important;
    height: auto !important; /* Let aspect-ratio determine height */
    min-height: 0 !important; /* Remove min-height constraint */
    max-width: 100% !important;
    max-height: 100% !important;
    aspect-ratio: var(--image-aspect-ratio, 16 / 9) !important; /* Use actual image aspect ratio */
  }
}

/* VALUE Composite Chart */
.valueComposite {
  display: flex;
  flex-direction: column;
  gap: var(--mm-space-4);
}

/* Unknown Chart Type */
.unknown {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%; /* Fill parent height */
  background: var(--chartErrorBackground);
  color: var(--chartErrorText);
  font-size: var(--mm-font-size-sm);
  font-weight: var(--mm-font-weight-medium);
}

/* Special Cases: CellWrapper + Chart Combinations */
/* WHAT: CellWrapper breaks container query inheritance */
/* WHY: Charts need separate container-type for proper sizing */

/* CellWrapper + KPI Chart - No longer needed (KPI grid handles sizing) */

/* CellWrapper + Pie Chart */
.CellWrapper_bodyZone__ps_rO .pieChartContainer {
  /* WHAT: Fixed 40% height regardless of wrapper */
  flex: 0 0 40% !important;
  display: flex;
  align-items: center;
  justify-content: center;
}

.CellWrapper_bodyZone__ps_rO .pieLegend {
  /* WHAT: Preferred 30% height, can grow if needed - Layout Grammar: no scrolling */
  /* WHY: Maintain preferred legend size when inside CellWrapper (3:4:3 ratio), but allow growth */
  flex: 1 1 30% !important; /* Prefer 30%, but can grow if content exceeds (no scrolling) */
  /* WHAT: Removed max-height and overflow-y - Layout Grammar: content must fit without scrolling */
  display: flex;
  flex-direction: column;
  justify-content: flex-start !important; /* WHAT: Changed from center to flex-start to prevent clipping in constrained blocks */
  overflow: visible !important; /* WHAT: Changed from hidden to visible - Layout Grammar: content must be visible, container grows to fit */
  box-sizing: border-box;
}

/* CellWrapper + Bar Chart */
.CellWrapper_bodyZone__ps_rO .barRow {
  /* WHAT: Container queries for bar sizing inside wrapper */
  container-type: size;
}

/* Responsive Adjustments */
@media (max-width: 768px) {
  .pieSegments {
    flex-direction: column;
    gap: var(--mm-space-4);
  }
  
  .barTable {
    /* WHAT: Mobile - table remains responsive, rows expand naturally */
    /* WHY: Tables are naturally responsive, no special mobile handling needed */
    width: 100%;
    margin: 0 auto; /* WHAT: Center table on mobile too */
  }
  
  .barLabel {
    /* WHAT: Mobile - adjust label column width for smaller screens */
    width: 45%; /* WHAT: Even wider label column on mobile for better readability */
    padding-right: var(--mm-space-1);
  }
  
  .barTrackCell {
    /* WHAT: Mobile - track column fills remaining space */
    padding: 0 var(--mm-space-1);
  }
  
  .barValue {
    /* WHAT: Mobile - value column auto-width, same font size as label */
    padding-left: var(--mm-space-1);
    font-size: var(--block-base-font-size); /* WHAT: Same font size as label */
  }
  
  /* WHAT: Charts must scale to fit their container on mobile
   * WHY: Prevent overflow - charts must behave same as desktop (scale and fit)
   * HOW: Maintain flexbox fill behavior, ensure container queries work properly */
/* A-R-11: Error Placeholder Styles */
.chartError {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--mm-space-6);
  text-align: center;
  color: var(--mm-color-text-secondary, #666);
  background: var(--chartBackground, #fff);
  border: 2px dashed var(--mm-color-border, #ddd);
  border-radius: var(--mm-radius-lg);
  min-height: 120px;
}

.chartErrorIcon {
  font-size: 2rem;
  color: var(--mm-color-error, #dc3545);
  margin-bottom: var(--mm-space-3);
}

.chartErrorTitle {
  font-size: var(--mm-font-size-md, 1rem);
  font-weight: var(--mm-font-weight-semibold, 600);
  margin-bottom: var(--mm-space-2);
  color: var(--mm-color-text, #333);
}

.chartErrorMessage {
  font-size: var(--mm-font-size-sm, 0.875rem);
  color: var(--mm-color-text-secondary, #666);
  line-height: 1.5;
  max-width: 100%;
  word-wrap: break-word;
}

  .chart:not(.image) {
    width: 100% !important;
    height: 100% !important; /* CRITICAL: Fill parent container */
    min-height: 250px !important; /* Minimum readable size */
    max-width: 100% !important;
    flex: 1 1 auto !important; /* Allow flex filling */
    overflow: hidden !important; /* Prevent content overflow */
    box-sizing: border-box !important;
    container-type: size; /* Ensure container queries work on mobile */
  }
  
  /* WHAT: PIE chart uses CSS Grid layout on mobile (same as desktop, same as KPI charts) */
  /* WHY: Table-style layout ensures fixed proportions, prevents overflow */
  /* HOW: CSS Grid with grid-template-rows: 3fr 4fr 3fr ensures content stays within frame */
  .pieGrid {
    display: grid !important; /* WHAT: CSS Grid layout (table-style) */
    grid-template-rows: 3fr 4fr 3fr !important; /* Title (30%) : Pie (40%) : Legend (30%) */
    height: 100% !important;
    width: 100% !important;
  }
  .pieTitleRow {
    /* WHAT: Grid row 1 - fixed 30% proportion */
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    min-height: 0 !important; /* Allow grid row to shrink if needed */
    overflow: hidden !important; /* Prevent overflow */
  }
  .pieChartContainer {
    /* WHAT: Grid row 2 - fixed 40% proportion */
    height: 100% !important; /* Fill grid row 2 */
    width: 100% !important;
    min-height: 0 !important; /* Allow grid row to shrink if needed */
    position: relative !important;
    overflow: visible !important; /* WHAT: P1 1.6 - Layout Grammar: no clipping on content layers, Chart.js canvas must be fully visible */
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
  }
  
  /* WHAT: Chart.js canvas fills container while maintaining aspect ratio
   * WHY: Canvas must fit within container on both desktop and mobile
   * HOW: Use percentage-based sizing with max constraints */
  .pieChartContainer canvas {
    width: 100% !important; /* Fill container width */
    height: 100% !important; /* Fill container height */
    max-width: 100% !important;
    max-height: 100% !important;
    aspect-ratio: 1 !important; /* Maintain circular shape */
    object-fit: contain !important; /* Ensure it fits within constraints */
  }
  
  /* WHAT: Pie legend - same behavior as desktop on mobile - Layout Grammar: no scrolling */
  /* WHY: Consistent sizing across all viewports, prevent collapse, content must fit */
  /* HOW: Maintain flex basis with max-height constraint (P1 1.4 Phase 3: removed min-height for deterministic behavior) */
  .pieLegend {
    flex: 0 0 auto !important; /* Let legend size to content */
    width: 100% !important;
    max-height: 50% !important; /* Allow growth but bound it */
    max-width: 100% !important;
    justify-content: flex-start !important; /* WHAT: Changed from center to flex-start to prevent clipping in constrained blocks */
    overflow: visible !important; /* WHAT: Changed from hidden to visible - Layout Grammar: content must be visible, container grows to fit */
    /* WHAT: Removed max-height and overflow-y - Layout Grammar: content must fit without scrolling */
    display: flex !important;
    flex-direction: column !important;
  }
  
  /* WHAT: Image charts respect aspect ratio on mobile
   * WHY: Images must maintain proper proportions without distortion
   * HOW: Use aspect-ratio CSS property for reliable sizing */
  .image {
    width: 100% !important;
    height: auto !important; /* Let aspect-ratio determine height */
    min-height: 0 !important; /* Remove min-height constraint */
    max-width: 100% !important;
    display: flex !important;
    flex-direction: column !important;
    overflow: hidden !important;
  }
  
  /* WHAT: Aspect ratio classes for image containers on mobile */
  .image.aspect169 {
    aspect-ratio: 16 / 9;
  }
  
  .image.aspect916 {
    aspect-ratio: 9 / 16;
  }
  
  .image.aspect11 {
    aspect-ratio: 1 / 1;
  }
  
  .imageContent {
    /* WHAT: Image fills container maintaining aspect ratio
     * WHY: object-fit: contain shows full image without cropping
     * HOW: Same behavior as desktop - consistent across breakpoints */
    width: 100% !important;
    height: 100% !important;
    object-fit: contain !important; /* Show full image without cropping, maintaining aspect ratio */
    object-position: center !important;
    display: block !important;
  }
}
