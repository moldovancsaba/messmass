
/* WHAT: ReportChart Component Styles (v12.0.0)
 * WHY: Clean, token-based styling for all chart types
 * HOW: CSS modules with design tokens from theme.css
 */

/* Base Chart Container */
.chart {
  /* WHAT: Flexbox container for consistent internal layout */
  display: flex;
  flex-direction: column;
  width: 100% !important; /* WHAT: Fill parent gridItem horizontally (CRITICAL FIX) */
  max-width: none !important; /* CRITICAL: Remove any max-width constraints */
  height: var(--block-height, var(--row-height, 100%)); /* WHAT: Use centrally managed block-height from row, fallback to row-height, then 100% */
  flex: 1 1 auto; /* CRITICAL: Allow chart to grow and fill space */
  /* REMOVED: min-height - row height is deterministic from block calculator */
  
  /* UNIFIED NAMING: --chartBackground matches database property */
  background: var(--chartBackground) !important;
  border-radius: var(--mm-radius-lg);
  box-shadow: var(--mm-shadow-sm);
  padding: 0; /* WHAT: Remove padding, add to header/body instead */
  overflow: hidden; /* WHAT: Prevent content overflow */
  box-sizing: border-box !important;
  /* Enable container queries for inner scaling (width + height) */
  container-type: size;
  /* REMOVED: transition - interferes with container query recalculation */
}

/* Chart Header - Titles and metadata */
.chartHeader {
  padding: var(--mm-space-4) var(--mm-space-5);
  border-bottom: 1px solid var(--chartBorder);
  flex-shrink: 0; /* WHAT: Prevent header from shrinking */
}

/* Chart Body - Main content area */
.chartBody {
  flex: 1; /* WHAT: Expand to fill available space */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: center;
  padding: var(--mm-space-2);
  min-height: 0; /* WHAT: Allow flex shrinking if needed */
}

/* Chart Title - Standardized across all types */
.chartTitle {
  /* Scale title to container width: min 0.9rem, grows with box, caps at 1.25rem */
  font-size: clamp(0.9rem, 2.8cqw, 1.25rem);
  font-weight: var(--mm-font-weight-semibold);
  color: var(--chartTitleColor);
  margin: 0;
  line-height: 1.2;
  text-align: center; /* WHAT: Center align chart titles */
}

/* No Data State */
.noData {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%; /* Fill parent height */
  background: var(--chartNoDataBackground);
  border: 2px dashed var(--chartNoDataBorder);
}

.noDataContent {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--mm-space-2);
  color: var(--chartNoDataText);
}

.noDataIcon {
  font-size: var(--mm-font-size-3xl);
  opacity: 0.5;
}

.noDataText {
  font-size: var(--mm-font-size-base);
  font-weight: var(--mm-font-weight-medium);
}

.noDataLabel {
  font-size: var(--mm-font-size-sm);
  color: var(--chartNoDataText);
}

/* KPI Chart - 3-row grid: Icon (40%), Value (30%), Title (30%) */
.kpi {
  /* WHAT: Full height cell with internal 3-row grid (4fr:3fr:3fr = 40%:30%:30%) */
  /* WHY: Larger icon section for visual impact */
  /* HOW: Direct grid layout with vertical centering for all content */
  height: var(--block-height, var(--row-height, 100%)); /* WHAT: Use centrally managed block-height from row */
  display: grid;
  grid-template-rows: 4fr 3fr 3fr; /* Icon (top 40%) : Value (middle 30%) : Title (bottom 30%) */
  gap: 0;
  width: 100%;
  box-sizing: border-box;
  align-items: center; /* CRITICAL: Vertically center content in each row */
  justify-items: center; /* CRITICAL: Horizontally center content */
}

.kpiIconRow {
  /* WHAT: Grid row 1 (40%) for icon */
  /* WHY: First row of 4fr-3fr-3fr grid */
  /* HOW: Flex centering with container queries, fully centered vertically */
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  container-type: size;
}

.kpiIcon {
  /* WHAT: Material Icons scale by font-size, 85% of icon row */
  /* WHY: Visual impact - large icon dominates top 40% */
  /* HOW: Container query on .kpiIconRow, vertically centered */
  font-size: clamp(2.5rem, 85cqh, 7rem) !important; /* 85% of icon row height */
  height: auto !important;
  width: auto !important;
  color: var(--kpiIconColor) !important;
  line-height: 1 !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
}

.kpiValueRow {
  /* WHAT: Grid row 2 (30%) for value */
  /* WHY: Middle row of 4fr-3fr-3fr grid */
  /* HOW: Flex centering for responsive value scaling, fully vertically centered */
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  font-size: clamp(1.25rem, min(18cqh, 20cqw), 5rem);
  font-weight: var(--mm-font-weight-bold);
  color: var(--chartValueColor);
  line-height: 0.85;
  text-align: center;
  letter-spacing: -0.04em;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  container-type: size;
}

.kpi .kpiTitle {
  /* WHAT: 3rd grid row (30%) - title at bottom of KPI */
  /* WHY: Grid row 3 = bottom 30% of cell */
  /* HOW: Flex with center alignment - fully vertically centered */
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  width: 100%;
  height: 100%;
  padding: var(--mm-space-2);
  /* Font scales based on container height (3fr row) */
  font-size: clamp(0.75rem, 8cqh, 1.125rem);
  font-weight: var(--mm-font-weight-medium);
  color: var(--chartLabelColor);
  line-height: 1.1;
  word-break: break-word;
  hyphens: none;
  overflow: hidden;
}

.kpi .kpiTitle > * {
  /* WHAT: Inner content wrapper for text truncation */
  /* WHY: Allows flex centering while maintaining line clamp */
  /* HOW: Use -webkit-box for line clamping inside flex container */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 2;
  overflow: hidden;
  text-align: center;
  width: 100%;
}

/* Pie Chart - Uses base .chart structure */

/* Container grid for title (40%), pie (40%), legend (20%) */
.pieGrid {
  height: 100%;
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: flex-start;
}

/* Title row: 40% of cell, vertically centered */
.pieTitleRow {
  flex: 0 0 30%; /* 3:4:3 → title 30% */
  display: flex;
  align-items: center;
  justify-content: center;
  padding: var(--mm-space-1) var(--mm-space-2);
}

.pieTitleText {
  margin: 0;
  text-align: center;
  font-weight: var(--mm-font-weight-semibold);
  color: var(--chartTitleColor);
  /* Doubled title font vs. previous */
  font-size: clamp(1rem, 9cqh, 1.5rem);
  line-height: 1.2;
}

/* Pie Chart - Uses base .chart structure */
.pie .chartBody {
  /* WHAT: Flex column with 40:40:20 split (title:pie:legend) */
  /* WHY: Balanced proportions for all elements */
  /* HOW: Use flex-basis for fixed height proportions */
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: 0;
  height: 100%;
  width: 100%;
  container-type: size;
  align-items: stretch;
  justify-content: flex-start;
}

.pieTitle {
  font-size: clamp(0.9rem, 2.6cqw, 1.2rem);
  font-weight: var(--mm-font-weight-semibold);
  color: var(--chartTitleColor);
  margin-bottom: var(--mm-space-1);
  text-align: center;
}

.pieSegments {
  display: flex;
  gap: var(--mm-space-1);
  justify-content: center;
}

.pieSegment {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--mm-space-2);
}

.pieColor {
  width: 32px;
  height: 32px;
  border-radius: var(--mm-radius-full);
  box-shadow: var(--mm-shadow-sm);
}

.pieLabel {
  font-size: clamp(0.7rem, 2cqw, 0.9rem);
  color: var(--chartLabelColor);
  font-weight: var(--mm-font-weight-medium);
}

.pieValue {
  font-size: clamp(1rem, 3cqw, 1.4rem);
  font-weight: var(--mm-font-weight-bold);
  color: var(--chartValueColor);
}

.piePercent {
  font-size: var(--mm-font-size-sm);
  color: var(--chartLabelColor);
}

/* Pie Chart Container for Chart.js - 40% of pieGrid height */
.pieChartContainer {
  /* WHAT: 40% of pieGrid height for pie chart */
  /* WHY: Middle section of 30:40:30 ratio (title:pie:legend = 3:4:3) */
  /* HOW: Flex basis for fixed height proportion with minimum size guarantee */
  flex: 0 0 40%; /* 3:4:3 → pie 40% */
  width: 100%;
  min-height: 100px; /* CRITICAL: Reduced from 150px to prevent overflow in small containers (1 unit in 5-unit block) */
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  container-type: size;
  overflow: hidden;
}

/* Custom Pie Legend - 30% of body height */
.pieLegend {
  /* WHAT: 30% of body height for legend items */
  /* WHY: Bottom section of 30:40:30 ratio (title:pie:legend = 3:4:3) */
  /* HOW: Flex basis for fixed height proportion, vertically centered, scrollable when content exceeds */
  flex: 0 0 30%; /* 3:4:3 → legend 30% - don't grow or shrink */
  display: flex;
  flex-direction: column;
  justify-content: center; /* CRITICAL: Center content vertically in its space */
  align-items: center;
  gap: var(--mm-space-1);
  width: 100%;
  container-type: size;
  min-height: 60px; /* CRITICAL: Prevent collapse on mobile */
  max-height: 30%; /* CRITICAL: Never exceed 30% of parent - this enables scrolling */
  overflow-y: auto; /* CRITICAL: Scroll when content exceeds max-height */
  overflow-x: hidden;
  padding: var(--mm-space-1);
  box-sizing: border-box;
}

.pieLegendItem {
  /* WHAT: Flex container for legend item with colored square */
  /* WHY: Display indicator + label in horizontal layout, centered */
  /* HOW: Flex with center alignment for both vertical and horizontal centering */
  display: flex;
  align-items: center;
  justify-content: center; /* WHAT: Center legend items horizontally */
  gap: var(--mm-space-2);
  width: auto; /* WHAT: Auto width to allow centering as a group */
  /* Remove fixed height so items don't stretch; rely on content and legend container */
}

.pieLegendDot {
  /* WHAT: Colored SQUARE (not dot) matching pie slice color */
  /* WHY: Visual indicator of which legend item corresponds to which pie slice */
  /* HOW: Square shape scaled to fit available space, no border radius */
  width: clamp(0.7rem, 6cqh, 1rem); /* Reduced: 10cqh → 6cqh to prevent overflow */
  height: clamp(0.7rem, 6cqh, 1rem);
  border-radius: 0; /* SQUARE, not circle */
  flex-shrink: 0;
  box-sizing: border-box;
  /* WHAT: Dynamic colors from CSS custom properties set on parent */
  /* WHY: Colors come from chart data, cannot use static CSS classes */
  background-color: var(--dot-color, var(--pieColor1, var(--mm-color-primary-500)));
  /* WHAT: Border color and width match pie chart border (2px solid first pie color) */
  border: 2px solid var(--dot-border-color, var(--pieColor1, var(--mm-color-primary-500)));
}

.pieLegendText {
  /* WHAT: Legend text scaled to fit available space with responsive sizing */
  /* WHY: Make legend text readable in both large and small blocks, prevent overflow */
  /* HOW: Use container queries for both width and height, design tokens for bounds */
  /* Layout Grammar: No overflow, no truncation - text scales to fit */
  font-size: clamp(
    var(--mm-font-size-xs, 0.75rem),   /* WHAT: Min 12px for small containers (prevents overflow) */
    min(12cqh, 8cqw),                  /* WHAT: Responsive scaling - use smaller of height or width constraint */
    var(--mm-font-size-xl, 1.25rem)   /* WHAT: Max 20px for large containers (better readability) */
  );
  font-weight: var(--mm-font-weight-medium);
  color: var(--chartLabelColor);
  line-height: 1.3; /* WHAT: Increased from 1.2 for better readability */
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  flex: 0 1 auto; /* WHAT: Don't grow, allow shrink, auto width for centering */
}

/* Bar Chart - Uses base .chart structure */
.bar .chartBody {
  /* WHAT: Remove restrictive width constraints - let chart fill parent */
  /* WHY: chartBody was limiting width to ~40px, breaking bar visibility */
  /* HOW: Use flex with no width limitations */
  padding: var(--mm-space-2);
  display: flex;
  flex-direction: column;
  flex: 1;
  min-height: 0;
  width: 100% !important; /* CRITICAL: No width restrictions */
  max-width: none !important; /* CRITICAL: Remove max-width */
}

.barTitle {
  font-size: clamp(0.9rem, 2.6cqw, 1.2rem);
  font-weight: var(--mm-font-weight-semibold);
  color: var(--chartTitleColor);
  margin-bottom: var(--mm-space-1);
  flex-shrink: 0; /* WHAT: Prevent title from shrinking */
}

.barElements {
  display: flex;
  flex-direction: column;
  gap: 0;
  flex: 1; /* CRITICAL: Fill ALL remaining vertical space */
  justify-content: space-evenly; /* WHAT: Distribute bars evenly across full height */
  width: 100%; /* CRITICAL: Fill full chart width */
  max-width: none !important; /* CRITICAL: Remove max-width */
  min-height: 0; /* CRITICAL: Allow flex shrinking */
}

.barRow {
  /* WHAT: 5 bars distributed evenly with label, track, and value */
  /* WHY: Each bar gets equal vertical space in barElements container */
  /* HOW: Grid layout: 25% label | 50% track | 25% value */
  display: grid;
  grid-template-columns: 25% 1fr 25%; /* Label 25% | Track fills (50%) | Value 25% */
  gap: 0 var(--mm-space-2);
  align-items: center;
  flex: 1;
  padding: 0 var(--mm-space-1);
  container-type: size;
}

.barLabel {
  /* WHAT: Bar label - flexible, wraps to 2 lines if needed */
  /* WHY: Left column (25%) - readable labels, doubled font */
  /* HOW: Text truncation with 2-line max */
  display: -webkit-box;
  -webkit-box-orient: vertical;
  -webkit-line-clamp: 2;
  font-size: clamp(0.85rem, 9cqh, 1.1rem); /* DOUBLED: 4.5cqh → 9cqh */
  color: var(--chartLabelColor);
  font-weight: var(--mm-font-weight-medium);
  text-align: right;
  line-height: 1.1;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: var(--mm-space-1);
  display: flex;
  align-items: center;
  justify-content: flex-end;
}

.barTrack {
  /* WHAT: Full-width bar track (50% of grid - middle column) */
  /* WHY: Track fills available space between label and value */
  /* HOW: 100% width of grid column, 22% of cell height (doubled from 11%) */
  background: var(--chartNoDataBackground);
  height: clamp(1.2rem, 22cqh, 1.44rem); /* DOUBLED: 11cqh → 22cqh */
  width: 100%; /* CRITICAL: Fills entire middle grid column (50%) */
  border-radius: calc(clamp(1.2rem, 22cqh, 1.44rem) / 2);
  overflow: hidden;
}

.barFill {
  /* WHAT: Fills track based on percentage of max value */
  /* WHY: Visual representation of bar data */
  /* HOW: Width and color set via CSS custom properties from parent */
  height: 100%;
  width: var(--bar-width, 0%);
  background-color: var(--bar-color, var(--barColor1, var(--mm-color-primary-500)));
  border-radius: calc(clamp(1.2rem, 22cqh, 1.44rem) / 2);
  transition: width var(--transition-normal);
}

.barValue {
  /* WHAT: Bar value - right column (25%), displays formatted number */
  /* WHY: Right alignment for easy reading */
  /* HOW: Flex container for alignment, doubled font size */
  display: flex;
  align-items: center;
  justify-content: flex-start;
  height: clamp(1.2rem, 22cqh, 1.44rem); /* DOUBLED: Match bar height */
  font-size: clamp(1rem, 10cqh, 1.4rem); /* DOUBLED: 5cqh → 10cqh */
  font-weight: var(--mm-font-weight-bold);
  color: var(--chartValueColor);
  text-align: left;
  line-height: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Text Chart - Simple block structure with explicit vertical stacking */
.text {
  /* CRITICAL: Override base .chart flex display */
  display: block !important;
  flex-direction: unset !important;
  width: 100% !important;
  height: 100% !important; /* WHAT: Fill parent row height from layout grammar */
  /* CRITICAL: Ensure children stack vertically */
  position: relative !important;
}

.textTitleWrapper {
  /* WHAT: Title container - top of chart, fixed height */
  /* WHY: Separate block-level div that cannot be inline */
  display: block !important;
  width: 100% !important;
  height: auto !important;
  min-height: 0 !important;
  max-height: 30% !important; /* Limit title to max 30% of container */
  padding: var(--mm-space-2) !important;
  box-sizing: border-box !important;
  /* CRITICAL: Force block display - cannot be inline */
  clear: both !important;
  float: none !important;
}

.textTitleText {
  margin: 0 !important;
  padding: 0 !important;
  text-align: center !important;
  font-weight: var(--mm-font-weight-semibold) !important;
  color: var(--chartTitleColor) !important;
  font-size: clamp(0.95rem, 2.6cqw, 1.25rem) !important;
  line-height: 1.25 !important;
  display: -webkit-box !important;
  -webkit-box-orient: vertical !important;
  -webkit-line-clamp: 2 !important;
  overflow: hidden !important;
  word-break: break-word !important;
  width: 100% !important;
  box-sizing: border-box !important;
}

.textContentWrapper {
  /* WHAT: Content container - bottom of chart, fills remaining space */
  /* WHY: Separate block-level div that cannot be inline */
  display: flex !important; /* CRITICAL: Use flexbox for vertical centering */
  align-items: center !important; /* CRITICAL: Center content vertically */
  justify-content: center !important; /* CRITICAL: Center content horizontally */
  width: 100% !important;
  height: calc(100% - var(--mm-space-4)) !important; /* Fill remaining space minus title padding */
  min-height: 0 !important;
  padding: var(--mm-space-2) !important;
  box-sizing: border-box !important;
  /* CRITICAL: Force block display - cannot be inline */
  clear: both !important;
  float: none !important;
  /* CRITICAL: Ensure this is below title */
  position: relative !important;
  /* CRITICAL: Enable container queries for font scaling */
  container-type: size !important;
}

.textContent {
  /* WHAT: Container for markdown content - allows children to stack vertically */
  /* WHY: Markdown elements (p, h1, etc.) must stack vertically, not inline */
  /* HOW: Use block display with vertical stacking, centered content, scales to fit */
  display: block !important; /* CRITICAL: Block display allows children to stack */
  width: 100% !important;
  max-width: 100% !important;
  height: auto !important; /* CRITICAL: Auto height to fit content, parent flexbox centers it */
  max-height: 100% !important; /* CRITICAL: Don't exceed parent height */
  /* CRITICAL: Use unified font-size if available, otherwise scale with container queries */
  /* WHY: All text charts in a block should use the same font-size */
  /* HOW: Check for CSS custom property first, fallback to container query scaling */
  /* INCREASED: Max font-size to 4rem for optimal text sizing (fill space) */
  font-size: var(--unified-text-font-size, clamp(0.75rem, min(12cqh, 10cqw), 4rem)) !important;
  font-weight: var(--mm-font-weight-semibold);
  color: var(--textColor);
  line-height: 1.3;
  box-sizing: border-box;
  /* CRITICAL: Center the entire block of content */
  text-align: center !important;
  /* CRITICAL: No scrolling - Layout Grammar compliance (content must fit) */
  overflow: hidden !important; /* WHAT: No scrolling allowed per Layout Grammar */
  /* CRITICAL: Enable container queries for responsive scaling (fallback) */
  container-type: size !important;
}

/* WHAT: Markdown element styles inside text content
 * WHY: Support full markdown features with center alignment
 * HOW: Use relative font sizes (em) so they inherit container scaling
 * CRITICAL: All block elements must be display: block to stack vertically, center-aligned
 */

/* WHAT: Heading levels with relative sizes (h1-h6) */
/* WHY: Preserve heading hierarchy while maintaining center alignment */
/* HOW: Use relative font sizes (em) that inherit from .textContent base size */
.textMarkdown h1 {
  display: block !important;
  margin: 0.5em 0 !important;
  padding: 0 !important;
  font-weight: 700 !important;
  line-height: 1.2 !important;
  font-size: 1.5em !important; /* WHAT: Largest heading - 1.5x base size */
  width: 100% !important;
  box-sizing: border-box !important;
  color: inherit !important;
  text-align: center !important;
}

.textMarkdown h2 {
  display: block !important;
  margin: 0.5em 0 !important;
  padding: 0 !important;
  font-weight: 700 !important;
  line-height: 1.2 !important;
  font-size: 1.3em !important; /* WHAT: Second level - 1.3x base size */
  width: 100% !important;
  box-sizing: border-box !important;
  color: inherit !important;
  text-align: center !important;
}

.textMarkdown h3 {
  display: block !important;
  margin: 0.5em 0 !important;
  padding: 0 !important;
  font-weight: 700 !important;
  line-height: 1.2 !important;
  font-size: 1.1em !important; /* WHAT: Third level - 1.1x base size */
  width: 100% !important;
  box-sizing: border-box !important;
  color: inherit !important;
  text-align: center !important;
}

.textMarkdown h4 {
  display: block !important;
  margin: 0.5em 0 !important;
  padding: 0 !important;
  font-weight: 600 !important;
  line-height: 1.2 !important;
  font-size: 1.05em !important; /* WHAT: Fourth level - 1.05x base size */
  width: 100% !important;
  box-sizing: border-box !important;
  color: inherit !important;
  text-align: center !important;
}

.textMarkdown h5 {
  display: block !important;
  margin: 0.5em 0 !important;
  padding: 0 !important;
  font-weight: 600 !important;
  line-height: 1.2 !important;
  font-size: 1em !important; /* WHAT: Fifth level - same as base size */
  width: 100% !important;
  box-sizing: border-box !important;
  color: inherit !important;
  text-align: center !important;
}

.textMarkdown h6 {
  display: block !important;
  margin: 0.5em 0 !important;
  padding: 0 !important;
  font-weight: 600 !important;
  line-height: 1.2 !important;
  font-size: 0.95em !important; /* WHAT: Smallest heading - 0.95x base size */
  width: 100% !important;
  box-sizing: border-box !important;
  color: inherit !important;
  text-align: center !important;
}

.textMarkdown p {
  display: block !important; /* CRITICAL: Force block display */
  margin: 0 0 0.5em 0 !important;
  padding: 0 !important;
  width: 100% !important;
  box-sizing: border-box !important;
  font-size: 1em !important; /* CRITICAL: Explicit same size (inherit from .textContent) */
}

.textMarkdown p:last-child {
  margin-bottom: 0 !important;
}

.textMarkdown strong { 
  font-weight: 700 !important;
  display: inline !important; /* Bold stays inline within block */
}

.textMarkdown em { 
  font-style: italic !important;
  display: inline !important; /* Italic stays inline within block */
}

.textMarkdown ul,
.textMarkdown ol {
  display: block !important; /* CRITICAL: Force block display */
  margin: 0.5em 0 !important;
  padding-left: 1.5em !important; /* indent markers */
  text-align: left !important; /* lists read better left-aligned */
  width: 100% !important;
  box-sizing: border-box !important;
  font-size: 1em !important; /* CRITICAL: Same size as content */
}

.textMarkdown li { 
  display: list-item !important; /* CRITICAL: Force list-item display */
  margin: 0.15em 0 !important;
  font-size: 1em !important; /* CRITICAL: Same size as content */
}

.textMarkdown a { 
  color: var(--mm-blue-600) !important; 
  text-decoration: underline !important;
  display: inline !important; /* Links stay inline */
}

.textMarkdown a:hover { 
  color: var(--mm-blue-700) !important; 
}

/* CRITICAL: Ensure all markdown content is block-level by default */
.textMarkdown {
  display: block !important; /* CRITICAL: Markdown container is block */
  width: 100% !important;
  height: 100% !important;
  box-sizing: border-box !important;
  /* CRITICAL: Allow children to stack vertically */
  text-align: center !important;
  /* CRITICAL: All markdown elements inherit same font-size from .textContent */
  font-size: inherit !important;
  /* CRITICAL: Preserve line breaks but allow wrapping (not pre-wrap which breaks bold) */
  white-space: normal !important; /* Allow normal wrapping, markdown handles line breaks */
}

.textMarkdown > * {
  display: block !important; /* CRITICAL: All direct children are blocks */
  width: 100% !important;
  box-sizing: border-box !important;
  text-align: center !important; /* Center each block */
  font-size: 1em !important; /* CRITICAL: Same size for all elements */
}

/* WHAT: Remove duplicate h1 definition - already defined above with proper sizing */

/* WHAT: Blockquote styling with center alignment */
/* WHY: Support blockquotes with visual distinction */
.textMarkdown blockquote {
  display: block !important;
  margin: 0.5em 0 !important;
  padding: 0.5em 1em !important;
  border-left: 3px solid var(--mm-gray-300) !important;
  background: var(--mm-gray-50) !important;
  border-radius: var(--mm-radius-sm) !important;
  font-style: italic !important;
  width: 100% !important;
  box-sizing: border-box !important;
  text-align: center !important;
  font-size: 1em !important;
  color: inherit !important;
}

/* WHAT: Code block styling with center alignment */
/* WHY: Support code blocks with monospace font */
.textMarkdown pre {
  display: block !important;
  margin: 0.5em 0 !important;
  padding: 0.5em !important;
  background: var(--mm-gray-100) !important;
  border-radius: var(--mm-radius-sm) !important;
  overflow-x: auto !important;
  width: 100% !important;
  box-sizing: border-box !important;
  text-align: left !important; /* WHAT: Code blocks left-aligned for readability */
  font-size: 0.9em !important;
  font-family: 'Courier New', Courier, monospace !important;
}

/* WHAT: Inline code styling */
/* WHY: Support inline code with monospace font */
.textMarkdown code {
  font-family: 'Courier New', Courier, monospace !important;
  font-size: 0.9em !important;
  background: var(--mm-gray-100) !important;
  padding: 0.15em 0.3em !important;
  border-radius: var(--mm-radius-xs) !important;
  display: inline !important;
}

/* WHAT: Code block code (nested in pre) */
/* WHY: Code blocks use pre>code structure */
.textMarkdown pre code {
  display: block !important;
  background: transparent !important;
  padding: 0 !important;
  font-size: 1em !important;
}

/* WHAT: Strikethrough styling */
/* WHY: Support strikethrough text decoration */
.textMarkdown del,
.textMarkdown s {
  text-decoration: line-through !important;
  display: inline !important;
  color: var(--mm-gray-500) !important;
}

/* WHAT: Horizontal rule styling */
/* WHY: Support horizontal rules for visual separation */
.textMarkdown hr {
  display: block !important;
  border: none !important;
  border-top: 1px solid var(--mm-gray-300) !important;
  margin: 1em 0 !important;
  width: 100% !important;
  box-sizing: border-box !important;
}

/* Override for inline elements (they stay inline within their block parent) */
.textMarkdown strong,
.textMarkdown em,
.textMarkdown a,
.textMarkdown code:not(pre code),
.textMarkdown del,
.textMarkdown s {
  display: inline !important;
  width: auto !important;
  text-align: inherit !important;
}

/* Table Chart - Markdown table display */
.table {
  background: var(--chartBackground) !important;
  border-radius: var(--mm-radius-lg);
}

.tableContent {
  width: 100%;
  height: 100%;
  overflow: hidden;
  padding: var(--mm-space-4);
  display: flex;
  flex-direction: column;
}

.tableMarkdown {
  width: 100%;
  height: 100%;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

.tableMarkdown table {
  width: 100%;
  border-collapse: collapse;
  border-spacing: 0;
  margin: 0;
  font-size: clamp(0.75rem, 1.5cqw, 0.875rem);
  table-layout: auto;
}

.tableMarkdown table thead {
  background: var(--chartTitleColor, var(--mm-gray-100));
  font-weight: var(--mm-font-weight-semibold);
}

.tableMarkdown table th {
  padding: var(--mm-space-3) var(--mm-space-4);
  text-align: left;
  border-bottom: 2px solid var(--chartBorder, var(--mm-gray-300));
  color: var(--chartValueColor, var(--mm-gray-900));
}

.tableMarkdown table td {
  padding: var(--mm-space-3) var(--mm-space-4);
  border-bottom: 1px solid var(--chartBorder, var(--mm-gray-200));
  color: var(--chartValueColor, var(--mm-gray-900));
}

.tableMarkdown table tbody tr:hover {
  background: var(--mm-gray-50);
}

.tableMarkdown table tbody tr:last-child td {
  border-bottom: none;
}

/* Table markdown content styling */
.tableMarkdown p {
  margin: 0 0 0.5em 0;
}

.tableMarkdown strong { font-weight: 700; }
.tableMarkdown em { font-style: italic; }

.tableMarkdown a { color: var(--mm-blue-600); text-decoration: underline; }
.tableMarkdown a:hover { color: var(--mm-blue-700); }

/* Image Chart - Container */
/* WHAT: Chart container for image charts */
.image {
  background: transparent !important; /* WHAT: No background on chart container, image container has background */
  padding: 0; /* WHAT: No padding, image container handles spacing */
}

/* WHAT: Image container with dynamic aspect ratio from actual image dimensions */
/* WHY: Use real image dimensions instead of configured aspect ratio for accurate display */
/* HOW: Container uses CSS custom property --image-aspect-ratio set dynamically from image naturalWidth/naturalHeight */
.imageContainer {
  background: var(--chartBackground) !important;
  border-radius: var(--mm-radius-lg); /* Rounded corners for image container */
  box-shadow: var(--mm-shadow-sm);
  overflow: hidden !important; /* Clip image to rounded corners */
  display: flex;
  align-items: center;
  justify-content: center;
  /* WHAT: Container fills width, height constrained by actual image aspect ratio */
  /* WHY: Body zone is flex container with center alignment, image should fill available width */
  width: 100%; /* Fill available width in body zone */
  max-width: 100%; /* Don't exceed body zone width */
  max-height: 100%; /* Don't exceed body zone height */
  height: auto; /* Height calculated from aspect ratio */
  /* WHAT: Use CSS custom property for dynamic aspect ratio */
  /* WHY: Aspect ratio is detected from actual image dimensions, not configured value */
  aspect-ratio: var(--image-aspect-ratio, 16 / 9); /* Fallback to 16:9 if not set */
}

/* WHAT: <img> element fills container completely */
/* WHY: Image should fill the aspect-ratio-constrained container */
/* HOW: Use object-fit: contain to show full image without cropping, maintaining aspect ratio */
.imageContent {
  display: block;
  width: 100%; /* Fill container width */
  height: 100%; /* Fill container height */
  object-fit: contain; /* Show full image without cropping, maintaining aspect ratio */
  object-position: center; /* Center the image */
  border-radius: var(--mm-radius-lg); /* Match container rounded corners */
}

/* WHAT: Image container on mobile - same dynamic aspect ratio approach */
/* WHY: Consistent behavior across breakpoints */
@media (max-width: 768px) {
  .imageContainer {
    width: 100% !important;
    height: auto !important; /* Let aspect-ratio determine height */
    min-height: 0 !important; /* Remove min-height constraint */
    max-width: 100% !important;
    max-height: 100% !important;
    aspect-ratio: var(--image-aspect-ratio, 16 / 9) !important; /* Use actual image aspect ratio */
  }
}

/* VALUE Composite Chart */
.valueComposite {
  display: flex;
  flex-direction: column;
  gap: var(--mm-space-4);
}

/* Unknown Chart Type */
.unknown {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%; /* Fill parent height */
  background: var(--chartErrorBackground);
  color: var(--chartErrorText);
  font-size: var(--mm-font-size-sm);
  font-weight: var(--mm-font-weight-medium);
}

/* Special Cases: CellWrapper + Chart Combinations */
/* WHAT: CellWrapper breaks container query inheritance */
/* WHY: Charts need separate container-type for proper sizing */

/* CellWrapper + KPI Chart - No longer needed (KPI grid handles sizing) */

/* CellWrapper + Pie Chart */
.CellWrapper_bodyZone__ps_rO .pieChartContainer {
  /* WHAT: Fixed 40% height regardless of wrapper */
  flex: 0 0 40% !important;
  display: flex;
  align-items: center;
  justify-content: center;
}

.CellWrapper_bodyZone__ps_rO .pieLegend {
  /* WHAT: Fixed 30% height regardless of wrapper */
  /* WHY: Maintain consistent legend size when inside CellWrapper (3:4:3 ratio) */
  flex: 0 0 30% !important; /* Override any conflicting flex values */
  max-height: 30% !important; /* CRITICAL: Never exceed 30% - enables scrolling */
  display: flex;
  flex-direction: column;
  justify-content: center; /* CRITICAL: Center content vertically in its space */
  overflow-y: auto; /* CRITICAL: Scroll when content exceeds max-height */
  box-sizing: border-box;
}

/* CellWrapper + Bar Chart */
.CellWrapper_bodyZone__ps_rO .barRow {
  /* WHAT: Container queries for bar sizing inside wrapper */
  container-type: size;
}

/* Responsive Adjustments */
@media (max-width: 768px) {
  .pieSegments {
    flex-direction: column;
    gap: var(--mm-space-4);
  }
  
  .barRow {
    /* WHAT: Same rem-based columns as desktop - fully responsive
     * WHY: No hardcoded pixels, consistent design token system */
    grid-template-columns: minmax(5rem, 22cqw) 1fr minmax(3.75rem, 16cqw);
    gap: var(--mm-space-2);
  }
  
  .barLabel {
    font-size: var(--mm-font-size-xs);
  }
  
  /* WHAT: Charts must scale to fit their container on mobile
   * WHY: Prevent overflow - charts must behave same as desktop (scale and fit)
   * HOW: Maintain flexbox fill behavior, ensure container queries work properly */
  .chart:not(.image) {
    width: 100% !important;
    height: 100% !important; /* CRITICAL: Fill parent container */
    min-height: 250px !important; /* Minimum readable size */
    max-width: 100% !important;
    flex: 1 1 auto !important; /* Allow flex filling */
    overflow: hidden !important; /* Prevent content overflow */
    box-sizing: border-box !important;
    container-type: size; /* Ensure container queries work on mobile */
  }
  
  /* WHAT: Pie chart container - same behavior as desktop on mobile
   * WHY: Consistent sizing across all viewports, prevent collapse
   * HOW: Maintain flex basis with minimum height, let canvas fill container */
  .pieChartContainer {
    flex: 0 0 40% !important; /* Same as desktop - 40% of pieGrid (3:4:3 ratio) */
    width: 100% !important;
    min-height: 100px !important; /* CRITICAL: Reduced from 150px to prevent overflow in small containers */
    max-width: 100% !important;
    max-height: 100% !important;
    position: relative !important;
    overflow: hidden !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
  }
  
  /* WHAT: Chart.js canvas fills container while maintaining aspect ratio
   * WHY: Canvas must fit within container on both desktop and mobile
   * HOW: Use percentage-based sizing with max constraints */
  .pieChartContainer canvas {
    width: 90% !important; /* Fill 90% of container width */
    height: 90% !important; /* Fill 90% of container height */
    max-width: 100% !important;
    max-height: 100% !important;
    aspect-ratio: 1 !important; /* Maintain circular shape */
    object-fit: contain !important; /* Ensure it fits within constraints */
  }
  
  /* WHAT: Pie legend - same behavior as desktop on mobile
   * WHY: Consistent sizing across all viewports, prevent collapse
   * HOW: Maintain flex basis with minimum height */
  .pieLegend {
    flex: 0 0 20% !important; /* Same as desktop - 20% of pieGrid */
    width: 100% !important;
    min-height: 60px !important; /* CRITICAL: Prevent collapse */
    max-width: 100% !important;
    max-height: 100% !important;
    overflow-y: auto !important;
    display: flex !important;
    flex-direction: column !important;
    justify-content: center !important;
  }
  
  /* WHAT: Image charts respect aspect ratio on mobile
   * WHY: Images must maintain proper proportions without distortion
   * HOW: Use aspect-ratio CSS property for reliable sizing */
  .image {
    width: 100% !important;
    height: auto !important; /* Let aspect-ratio determine height */
    min-height: 0 !important; /* Remove min-height constraint */
    max-width: 100% !important;
    display: flex !important;
    flex-direction: column !important;
    overflow: hidden !important;
  }
  
  /* WHAT: Aspect ratio classes for image containers on mobile */
  .image.aspect169 {
    aspect-ratio: 16 / 9;
  }
  
  .image.aspect916 {
    aspect-ratio: 9 / 16;
  }
  
  .image.aspect11 {
    aspect-ratio: 1 / 1;
  }
  
  .imageContent {
    /* WHAT: Image fills container maintaining aspect ratio
     * WHY: object-fit: contain shows full image without cropping
     * HOW: Same behavior as desktop - consistent across breakpoints */
    width: 100% !important;
    height: 100% !important;
    object-fit: contain !important; /* Show full image without cropping, maintaining aspect ratio */
    object-position: center !important;
    display: block !important;
  }
}
