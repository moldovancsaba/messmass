/* WHAT: ReportChart Component Styles (v12.0.0)
 * WHY: Clean, token-based styling for all chart types
 * HOW: CSS modules with design tokens from theme.css
 */

/* Base Chart Container */
.chart {
  /* WHAT: Flexbox container for consistent internal layout */
  display: flex;
  flex-direction: column;
  width: 100% !important; /* WHAT: Fill parent gridItem horizontally (CRITICAL FIX) */
  max-width: none !important; /* CRITICAL: Remove any max-width constraints */
  height: 100% !important; /* CRITICAL: Fill parent row height (deterministic) */
  flex: 1 1 auto; /* CRITICAL: Allow chart to grow and fill space */
  /* REMOVED: min-height - row height is deterministic from block calculator */
  
  /* WHAT: Visual styling */
  background: var(--mm-white) !important;
  border-radius: var(--mm-radius-lg);
  box-shadow: var(--mm-shadow-sm);
  padding: 0; /* WHAT: Remove padding, add to header/body instead */
  overflow: hidden; /* WHAT: Prevent content overflow */
  transition: all var(--transition-fast);
  box-sizing: border-box !important;
  /* Enable container queries for inner scaling (width + height) */
  container-type: size;
}

/* Chart Header - Titles and metadata */
.chartHeader {
  padding: var(--mm-space-4) var(--mm-space-5);
  border-bottom: 1px solid var(--mm-gray-100);
  flex-shrink: 0; /* WHAT: Prevent header from shrinking */
}

/* Chart Body - Main content area */
.chartBody {
  flex: 1; /* WHAT: Expand to fill available space */
  display: flex;
  flex-direction: column;
  align-items: stretch;
  justify-content: center;
  padding: var(--mm-space-2);
  min-height: 0; /* WHAT: Allow flex shrinking if needed */
}

/* Chart Title - Standardized across all types */
.chartTitle {
  /* Scale title to container width: min 0.9rem, grows with box, caps at 1.25rem */
  font-size: clamp(0.9rem, 2.8cqw, 1.25rem);
  font-weight: var(--mm-font-weight-semibold);
  color: var(--mm-gray-900);
  margin: 0;
  line-height: 1.2;
}

/* No Data State */
.noData {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%; /* Fill parent height */
  background: var(--mm-gray-50);
  border: 2px dashed var(--mm-gray-300);
}

.noDataContent {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--mm-space-2);
  color: var(--mm-gray-500);
}

.noDataIcon {
  font-size: var(--mm-font-size-3xl);
  opacity: 0.5;
}

.noDataText {
  font-size: var(--mm-font-size-base);
  font-weight: var(--mm-font-weight-medium);
}

.noDataLabel {
  font-size: var(--mm-font-size-sm);
  color: var(--mm-gray-400);
}

/* KPI Chart - Fully responsive with 3:5:2 grid ratio */
.kpi {
  /* WHAT: No aspect-ratio constraint - height determined by grid row */
  /* WHY: Grid system handles height equality across row */
  height: 100% !important; /* WHAT: Fill grid cell completely */
  min-height: 0 !important;
  display: flex !important;
  flex-direction: column !important;
}

.kpi .chartBody {
  /* WHAT: Fill full height and enable grid layout */
  display: flex !important;
  flex-direction: column !important;
  flex: 1 !important;
  height: 100% !important;
  padding: var(--mm-space-2) !important; /* REDUCED: Minimal padding for more content space */
}

.kpiContent {
  /* WHAT: CSS Grid with 3:5:2 ratio for icon:number:description */
  /* WHY: Keep consistent visual rhythm while maximizing value area without overflow */
  display: grid !important;
  grid-template-rows: 3fr 5fr 2fr; /* 30% icon, 50% value, 20% description */
  height: 100% !important;
  width: 100%;
  max-width: none !important;
  gap: 0; /* No gap - each section fills its allocated space */
  /* Base font size scales with container width, not viewport */
  font-size: clamp(0.9rem, 4.2cqw, 2.25rem) !important;
}

.kpiIconRow {
  /* WHAT: SVG Icon container row - occupies 3fr (30% height) */
  /* WHY: Always present in KPI charts - contains dynamically scaling SVG */
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  width: 100% !important;
  height: 100% !important;
}

.kpiIcon {
  /* WHAT: SVG Icon - slightly smaller to give more room to number */
  height: 75% !important;
  width: auto !important; /* Maintain aspect ratio */
  min-width: 0 !important;
  min-height: 0 !important;
  max-width: none !important;
  max-height: none !important;
  display: block !important;
  stroke-width: 1.5 !important;
  color: var(--mm-primary) !important;
}

.kpi .kpiValue {
  /* WHAT: Number row - dominant area, FULLY RESPONSIVE */
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  width: 100% !important;
  height: 100% !important;
  /* WHAT: Font scales with BOTH dimensions - no hardcoded breakpoints */
  /* WHY: Container queries (cqw/cqh) adapt to ANY screen size automatically */
  /* HOW: 25cqw = 25% of container width; for 7 chars, each char ~ 100%/7 = 14%, use generous 25% */
  /*      20cqh = 20% of container height; 5fr row = 50% total, use 40% of that = 20% */
  font-size: clamp(1.5rem, min(20cqh, 25cqw), 12rem) !important;
  font-weight: var(--mm-font-weight-bold) !important;
  color: var(--mm-gray-900) !important;
  line-height: 0.85 !important;
  text-align: center !important;
  letter-spacing: -0.04em; /* WHAT: Tight for large numbers */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.kpi .kpiTitle {
  /* WHAT: Keep subtitle readable but compact */
  display: -webkit-box !important;
  -webkit-box-orient: vertical !important;
  -webkit-line-clamp: 2 !important;
  align-self: center !important;
  justify-self: center !important;
  width: 100% !important;
  max-height: 100% !important;
  padding: 0 var(--mm-space-1) !important;
  font-size: clamp(0.65rem, 1.8cqw, 0.95rem) !important;
  color: var(--mm-gray-600) !important;
  font-weight: var(--mm-font-weight-medium) !important;
  text-align: center !important;
  line-height: 1.2 !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
  word-wrap: break-word !important;
}

/* Pie Chart - Uses base .chart structure */
.pie .chartBody {
  padding: var(--mm-space-3);
}

.pieTitle {
  font-size: clamp(0.9rem, 2.6cqw, 1.2rem);
  font-weight: var(--mm-font-weight-semibold);
  color: var(--mm-gray-900);
  margin-bottom: var(--mm-space-1);
  text-align: center;
}

.pieSegments {
  display: flex;
  gap: var(--mm-space-1);
  justify-content: center;
}

.pieSegment {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--mm-space-2);
}

.pieColor {
  width: 32px;
  height: 32px;
  border-radius: var(--mm-radius-full);
  box-shadow: var(--mm-shadow-sm);
}

.pieLabel {
  font-size: clamp(0.7rem, 2cqw, 0.9rem);
  color: var(--mm-gray-600);
  font-weight: var(--mm-font-weight-medium);
}

.pieValue {
  font-size: clamp(1rem, 3cqw, 1.4rem);
  font-weight: var(--mm-font-weight-bold);
  color: var(--mm-gray-900);
}

.piePercent {
  font-size: var(--mm-font-size-sm);
  color: var(--mm-gray-500);
}

/* Pie Chart Container for Chart.js */
.pieChartContainer {
  flex: 1; /* WHAT: Fill available vertical space */
  width: 100%;
  height: 100%; /* CRITICAL: Fill parent height */
  position: relative;
  /* REMOVED: min-height - height is deterministic from block calculator */
}

/* Bar Chart - Uses base .chart structure */
.bar .chartBody {
  padding: var(--mm-space-2);
  display: flex; /* CRITICAL: Enable flex layout */
  flex-direction: column; /* CRITICAL: Stack content vertically */
  flex: 1; /* CRITICAL: Fill available vertical space */
  min-height: 0; /* CRITICAL: Allow flex shrinking */
}

.barTitle {
  font-size: clamp(0.9rem, 2.6cqw, 1.2rem);
  font-weight: var(--mm-font-weight-semibold);
  color: var(--mm-gray-900);
  margin-bottom: var(--mm-space-1);
  flex-shrink: 0; /* WHAT: Prevent title from shrinking */
}

.barElements {
  display: flex;
  flex-direction: column;
  gap: 0;
  flex: 1; /* CRITICAL: Fill ALL remaining vertical space */
  justify-content: space-evenly; /* WHAT: Distribute bars evenly across full height */
  width: 100%; /* CRITICAL: Fill full chart width */
  max-width: none !important; /* CRITICAL: Remove max-width */
  min-height: 0; /* CRITICAL: Allow flex shrinking */
}

.barRow {
  display: grid;
  grid-template-columns: minmax(80px, 22cqw) 1fr minmax(60px, 16cqw);
  gap: var(--mm-space-1);
  align-items: center;
  flex: 1; /* WHAT: Each bar row takes equal vertical space */
  min-height: clamp(24px, 4cqh, 44px); /* WHAT: Scales with container height */
}

.barLabel {
  font-size: clamp(0.65rem, 1.8cqw, 0.9rem);
  color: var(--mm-gray-700);
  font-weight: var(--mm-font-weight-medium);
  text-align: right;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.barTrack {
  background: var(--mm-gray-200);
  height: clamp(14px, 2.6cqw, 32px);
  border-radius: var(--mm-radius-md);
  overflow: hidden;
}

.barFill {
  height: 100%;
  border-radius: var(--mm-radius-md);
  transition: width var(--transition-normal);
}

.barValue {
  font-size: clamp(0.75rem, 2cqw, 1rem);
  font-weight: var(--mm-font-weight-semibold);
  color: var(--mm-gray-900);
  text-align: right;
}

/* Text Chart - Uses base .chart structure */
.text {
  /* REMOVED: min-height - height is deterministic from block calculator */
}

.text .chartBody {
  align-items: flex-start;
  justify-content: flex-start;
}

.textTitle {
  font-size: clamp(0.95rem, 2.6cqw, 1.25rem);
  font-weight: var(--mm-font-weight-semibold);
  color: var(--mm-gray-900);
  margin-bottom: 0;
}

.textContent {
  flex: 1; /* CRITICAL: Fill available space */
  width: 100%; /* CRITICAL: Fill container width */
  font-size: clamp(0.85rem, 2.2cqw, 1rem);
  color: var(--mm-gray-700);
  line-height: 1.5;
  white-space: pre-wrap;
  padding: var(--mm-space-3); /* Add padding for readability */
}

/* Image Chart - SIMPLIFIED */
.image {
  background: var(--mm-white) !important;
  border-radius: var(--mm-radius-lg);
  box-shadow: var(--mm-shadow-sm);
  overflow: hidden !important;
  /* Inherits height: 100% from base .chart - fills row */
}

/* WHAT: <img> element fills container while maintaining aspect ratio */
/* WHY: object-fit: contain shows full image and respects natural aspect ratio */
.imageContent {
  display: block;
  width: 100%;
  height: 100%; /* Fill the .image container */
  object-fit: contain; /* Show full image, maintain natural aspect ratio */
  object-position: center;
}

/* NO aspect-ratio CSS needed - object-fit: contain maintains image's natural ratio */

/* VALUE Composite Chart */
.valueComposite {
  display: flex;
  flex-direction: column;
  gap: var(--mm-space-4);
}

/* Unknown Chart Type */
.unknown {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%; /* Fill parent height */
  background: var(--mm-red-50);
  color: var(--mm-red-700);
  font-size: var(--mm-font-size-sm);
  font-weight: var(--mm-font-weight-medium);
}

/* Responsive Adjustments */
@media (max-width: 768px) {
  .chart {
    padding: var(--mm-space-3);
  }
  
  .kpi {
    padding: var(--mm-space-4);
  }
  
  /* REMOVED: .kpiValue font-size override - let clamp() handle all screen sizes */
  
  .pieSegments {
    flex-direction: column;
    gap: var(--mm-space-4);
  }
  
  .barRow {
    grid-template-columns: 80px 1fr 60px;
    gap: var(--mm-space-2);
  }
  
  .barLabel {
    font-size: var(--mm-font-size-xs);
  }
}
