# AI Handover â€” Chart System Audit & P0 Hardening

Generated at: 2025-10-16T15:14:50.000Z
Version: 6.9.0

Purpose
- Provide a complete, self-contained handover so any teammate (or AI) can continue with zero prior context.

Executive recap
- Source of truth: Production API (MongoDB Atlas-backed) at /api/chart-config/public.
- Inventory: 35 â†’ 34 active charts after P0 deactivation (faces KPI).
- P0 fixes applied in Atlas to correct formulas/semantics and align with KYC goals.
- Version bumped to 6.9.0 and documentation synced with ISO timestamps.
- Build and type-check are green; linting has pre-existing issues unrelated to this change.

What changed (P0)
1) Engagement (bar) â€” Corrected all 5 elements
- Engaged: ([SEYUTOTALFANS]) / [SEYUATTENDEES] * 100
- Interactive: ([SEYUSOCIALVISIT] + [SEYUPROPOSITIONVISIT] + [SEYUPROPOSITIONPURCHASE]) / ([SEYUTOTALIMAGES]) * 100
- Front-runners: [SEYUMERCHEDFANS] / ([SEYUTOTALFANS]) * 100
- Fanaticals: ([SEYUFLAGS] + [SEYUMERCHSCARF]) / [SEYUMERCHEDFANS] * 100
- Casuals: (([SEYUTOTALFANS]) - [SEYUMERCHEDFANS]) / ([SEYUTOTALFANS]) * 100

2) Remote vs Event (pie)
- Now uses fans correctly: [SEYUREMOTEFANS] vs [SEYUSTADIUMFANS]

3) Merchandise (bar)
- Total label clarified to "Total items" (counts semantics; not revenue)

4) Value Prop Conversion Rate (kpi)
- Normalized token: [SEYUPROPOSITIONPURCHASE] / [SEYUPROPOSITIONVISIT] * 100

5) Faces (kpi)
- Deactivated duplicate/misleading chart (keep faces-per-image KPI)

Why (business/KYC/ROI)
- Prevent misleading metrics (e.g., images driving engagement %) and ensure sponsor-facing reports reflect true audience behavior (fans/attendees, merch penetration, funnels).
- Create a solid basis for next steps: parameterized value multipliers, Bitly enrichment, hashtag seasonality, SportsDB venue/league context.

How it was applied
- Atlas updates via script: scripts/fix-charts-p0.js
- Verification via production API: https://www.messmass.com/api/chart-config/public (34 active; updated formulas present)

Repo changes and state
- Version bump: package.json â†’ 6.9.0
- Docs updated with ISO 8601 ms timestamps:
  - ROADMAP.md (added Chart System P0 Hardening)
  - TASKLIST.md (added CHART-P0-001..005 as complete)
  - RELEASE_NOTES.md (v6.9.0 entry)
  - ARCHITECTURE.md (version+timestamp sync)
  - LEARNINGS.md (P0 hardening entry)
  - WARP.DEV_AI_CONVERSATION.md (delivery log)
  - WARP.md (footer version+timestamp)
- Build: success
- Type-check: success
- Lint: has pre-existing blocking issues (unescaped quotes in admin pages); not modified in this change.

Live endpoints & data
- Public chart configs (Atlas): GET https://www.messmass.com/api/chart-config/public
- Admin chart configs (auth required): GET /api/chart-config

Key invariants & rules to respect
- ISO 8601 with milliseconds for all timestamps.
- SEYU token normalization in formulas; guard division-by-zero â†’ NA.
- Do not mix semantics: counts vs people vs revenue.
- No tests (MVP factory), but type-check and prod build must pass. Lint is required by convention; known legacy issues exist.
- Versioning protocol: bump MINOR before commit; sync all docs.

Immediate next steps (P1)
1) Parameterize marketing multipliers (CPM/eDM/screen) per chart
- Add numeric parameters in DB-backed chart config; allow partner-level overrides later.
- Affected: value (bar) chart elements; replace constants 35/15/30/etc with parameters.

2) Bitly enrichment charts
- Device split: mobile/desktop/tablet
- Referrer platforms: Instagram/Facebook/Direct + top domain
- Geographic: countries reached + top country + unique/total ratio
- Implementation: add chart configs; ensure registry fields exist (already present in variablesRegistry)

3) Hashtag seasonality & partner benchmarks
- Sport share (% of events by sport category)
- Seasonality by time category (months/seasons/years)
- Partner filters (e.g., â€œsummerâ€ at â€œðŸ¤¾ HC Zagrebâ€ AND attendees > 1000)
- New charts + queries across projects.hashtags/categorizedHashtags

4) Governance & validation
- Admin UI: formula validator highlights deprecated tokens, division-by-zero, missing variables.
- Pre-save checks for chart types: KPI=1, Pie=2, Bar=5; require description.

SportsDB integration plan (P2)
- Partner matching: store sportsDbTeamId/leagueId/venueId on partners
- Import stadium capacity/geo â†’ venue utilization KPI (stadiumFans/capacity)
- Context tags: derby/home-away/standing; new charts (home vs away engagement, capacity utilization)
- API wrapper: lib/sportsDbApi.ts; endpoint: /api/sports-db/search; UI: button on partner editor

Operational checklist (repeatable)
- Fetch live charts: curl https://www.messmass.com/api/chart-config/public
- Apply changes: Atlas via a dedicated script; include createdAt/updatedAt ISO
- Validate: format with formulaEngine.validate; run type-check, build
- Docs sync: ROADMAP, TASKLIST, RELEASE_NOTES, WARP footer; timestamps with ms
- Version bump: MINOR for feature/refactor; ensure consistency
- Commit message: chore(release): vX.Y.Z <short scope> â€” ISO timestamp
- Push: main

Risks & mitigation
- Legacy lint errors: avoid touching unrelated files; plan separate lint-hardening pass.
- Formula regressions: use formulaEngine.validate + sample data test before save.
- Semantic drift: enforce counts/people/revenue separation in naming and labels.

Rollback plan
- Chart configs: export pre-change JSON; keep scripts/fix-charts-p0.js reversible.
- Version: bump patch with rollback notes if needed.

Pending artifacts created in this session
- scripts/fix-charts-p0.js (applied)
- scripts/audit-charts.js, scripts/explore-db.js (local audit utilities)
- docs updated; new version v6.9.0

Hand-off targets (who does what next)
- Charts engineer: implement parameterization (value chart), add Bitly/seasonality charts (P1)
- Backend engineer: SportsDB API wrapper + partner matching (P2)
- PM/Analyst: approve new KPIs, weights for Engagement Quality Score

Success criteria for next milestones
- P1: New charts live; value multipliers configurable; partner benchmarks view
- P2: SportsDB linked for 10+ partners; capacity utilization KPI visible

Appendix â€” key variables used
- Core: [SEYUTOTALFANS], [SEYUATTENDEES], [SEYUTOTALIMAGES], [SEYUMERCHEDFANS]
- Bitly: [SEYUSOCIALVISIT], [SEYUFACEBOOKVISIT], [SEYUINSTAGRAMVISIT], [SEYUYOUTUBEVISIT], [SEYUTIKTOKVISIT], [SEYUXVISIT]
- VP: [SEYUPROPOSITIONVISIT], [SEYUPROPOSITIONPURCHASE]
- Demographics: [SEYUGENALPHA], [SEYUGENYZ], [SEYUGENX], [SEYUBOOMER], [SEYUFEMALE], [SEYUMALE]
- Location: [SEYUREMOTEFANS], [SEYUSTADIUMFANS]

EOF
